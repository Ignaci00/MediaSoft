<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wizard Planificación Docente</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/themes/base/jquery-ui.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #0D3757;
      --secondary-color: #2196F3;
      --accent-color: #4cc9f0;
      --light-color: #f8f9fa;
      --success-color: #4CAF50;
    }
    
    body {
      background-color: #F5F5F5;
      font-family: "Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif;
    }
    
    .wizard-container {
      width: 95%;
      margin: 2rem auto;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
      border-radius: 4px;
      overflow: hidden;
      background: white;
    }
    
    .wizard-header {
      background-color: white;
      color: white;
      padding: 1.5rem;
      text-align: center;
      position: relative;
      background: linear-gradient(to top, white 30%, rgba(151, 151, 151, 0.603))
    }
    
    .wizard-title {
      font-weight: 700;
      margin-bottom: 0;
    }
    
    .wizard-progress {
      height: 8px;
      background-color: rgba(255, 255, 255, 0.3);
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
    }
    
    .wizard-progress-bar {
      height: 100%;
      width: 20%;
      background-color: var(--accent-color);
      border-radius: 0 4px 4px 0;
      transition: width 0.5s ease;
    }
    
    .wizard-body {
      padding: 2rem;
      background-color: white;
    }
    
    .wizard-card {
      padding: 1rem;
      border-radius: 12px;
      background-color: white;
    }
    
    .step-title {
      color: var(--primary-color);
      border-bottom: 2px solid var(--accent-color);
      padding-bottom: 1rem;
      margin-bottom: 1.5rem;
      position: relative;
      font-weight: 500;
      font-size: 18px;
      color: black;
      text-transform: uppercase;
    }
    
    .step-title::before {
      content: '';
      position: absolute;
      height: 2px;
      width: 60px;
      background-color: var(--primary-color);
      bottom: -2px;
    }
    
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
    }
    
    .form-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
    }
    
    .form-label i {
      margin-right: 8px;
      color: var(--primary-color);
    }
    
    .form-control {
      border-radius: 8px;
      border: 2px solid #ddd;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
    }
    
    .form-control:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
    }
    
    .input-group-text {
      background-color: var(--primary-color);
      color: white;
      border: none;
    }
    
    .form-select {
      border-radius: 8px;
      border: 2px solid #ddd;
      padding: 0.75rem 1rem;
      transition: all 0.3s ease;
    }
    
    .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
    }
    
    .tag-container {
      display: flex;
      flex-wrap: wrap;
      padding: 5px;
      border: 2px solid #ddd;
      border-radius: 8px;
      min-height: 58px;
      background-color: white;
    }
    
    .tag {
      display: flex;
      align-items: center;
      margin: 5px;
      padding: 5px 10px;
      background-color: var(--primary-color);
      color: white;
      border-radius: 30px;
      font-size: 0.9rem;
    }
    
    .tag-close {
      margin-left: 5px;
      cursor: pointer;
      font-size: 0.8rem;
    }
    
    .tag-input {
      flex: 1;
      border: none;
      outline: none;
      padding: 10px 5px;
      font-size: 1rem;
    }
    
    .dropzone {
      border: 2px dashed var(--primary-color);
      border-radius: 8px;
      padding: 2rem 1rem;
      text-align: center;
      transition: all 0.3s ease;
      background-color: rgba(67, 97, 238, 0.05);
      cursor: pointer;
    }
    
    .dropzone:hover {
      background-color: rgba(67, 97, 238, 0.1);
    }
    
    .dropzone i {
      font-size: 2rem;
      color: var(--primary-color);
      margin-bottom: 1rem;
    }
    
    .wizard-footer {
      display: flex;
      justify-content: space-between;
      padding: 1.5rem 2rem;
      background: linear-gradient(to bottom, white 30%, rgba(151, 151, 151, 0.603))
    }
    
    .btn-wizard {
      padding: 0.75rem 2rem;
      border-radius: 30px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
    }
    
    .btn-next {
      background-color: var(--primary-color);
      color: white;
    }
    
    .btn-next:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
      color: white;
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }

    .btn-prev {
      background-color: var(--primary-color);
      color: white;
    }

    .btn-prev:hover {
      background-color: var(--secondary-color);
      transform: translateY(-2px);
      color: white;
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.3);
    }
    
    .completion-icon {
      color: var(--success-color);
      font-size: 1.2rem;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .field-complete .completion-icon {
      opacity: 1;
    }
    
    .form-tip {
      font-size: 0.85rem;
      color: #6c757d;
      margin-top: 0.5rem;
    }
    
    .animation-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }
    
    /* Estilos para los componentes de selección múltiple */
    .multi-select-container {
      position: relative;
    }
    
    .multi-select-selected {
      padding: 0.75rem 1rem;
      border: 2px solid #ddd;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .multi-select-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      margin-top: 5px;
      z-index: 10;
      max-height: 200px;
      overflow-y: auto;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      display: none;
    }
    
    .multi-select-item {
      padding: 10px 15px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .multi-select-item:hover {
      background-color: rgba(67, 97, 238, 0.1);
    }
    
    .multi-select-item.selected {
      background-color: rgba(67, 97, 238, 0.2);
      font-weight: 600;
    }
    
    /* Animaciones para los elementos */
    .animated-element {
      animation: fadeInUp 0.5s ease;
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

.list-group-item {
  cursor: move;
  background: white;
  margin-bottom: 5px;
  border: 1px solid rgba(0,0,0,.125);
  padding: 10px 15px;
  border-radius: 4px;
  display: flex;
  align-items: center;
}

.list-group-item .fa-grip-vertical {
  color: #999;
  margin-right: 10px;
  cursor: grab;
}

.list-group-item.ui-sortable-helper {
  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  border: 1px solid var(--primary-color);
}

.ui-sortable-placeholder {
  visibility: visible !important;
  background: rgba(67, 97, 238, 0.1);
  border: 2px dashed var(--primary-color);
}

.nivel-card {
  cursor: pointer;
  transition: all 0.3s ease;
  border: 2px solid #ddd;
}

.nivel-card:hover {
  transform: translateY(-5px);
  border-color: var(--primary-color);
  box-shadow: 0 5px 15px rgba(67, 97, 238, 0.2);
}

.nivel-card.selected {
  background-color: rgba(67, 97, 238, 0.1);
  border-color: var(--primary-color);
}

.nivel-card i {
  font-size: 2rem;
  color: var(--primary-color);
}

.method-card {
  cursor: pointer;
  transition: all 0.3s ease;
  height: 100%;
}

.method-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(67, 97, 238, 0.2);
}

.method-card.selected {
  background-color: rgba(67, 97, 238, 0.1);
  border-color: var(--primary-color);
}

.method-card i {
  font-size: 2rem;
  color: var(--primary-color);
}

.activity-option {
  transition: all 0.3s ease;
}

.activity-option.selected {
  background-color: var(--primary-color);
  color: white;
}

.activity-section h6 {
  color: var(--primary-color);
  border-bottom: 2px solid var(--accent-color);
  padding-bottom: 0.5rem;
  margin-bottom: 1rem;
}

  .resource-card {
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .resource-card.selected {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }
  
  .resource-options {
    overflow: hidden;
  }
  
  .custom-resource-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 6px 10px;
    margin-bottom: 5px;
    background-color: #f8f9fa;
    border-radius: 4px;
    transition: all 0.2s ease;
  }
  
  .custom-resource-item:hover {
    background-color: #e9ecef;
  }
  
  .custom-resource-item > div {
    display: flex;
    align-items: center;
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  
  .custom-resource-item i.fa-cube,
  .custom-resource-item i.fa-globe {
    margin-right: 8px;
    color: #6c757d;
  }
  
  .custom-resource-item span {
    margin-right: 8px;
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .custom-resource-item .resource-link {
    color: #0d6efd;
    margin-left: 5px;
  }
  
  .custom-resource-item .delete-resource {
    cursor: pointer;
    color: #dc3545;
    transition: transform 0.2s ease;
  }
  
  .custom-resource-item .delete-resource:hover {
    transform: scale(1.2);
  }

.activity-item {
  margin-bottom: 8px;
  border: 1px solid rgba(0,0,0,.125);
  padding: 8px 12px;
  border-radius: 4px;
  background-color: #f8f9fa;
}

.activity-inputs {
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 8px;
  background-color: white;
}

.activities-list {
  margin-top: 10px;
}

.btn-close {
  font-size: 0.8rem;
}

/* Añade estos estilos al bloque <style> existente */
/* Estilización del scrollbar */
.secciones-container::-webkit-scrollbar {
  width: 6px;
  height: 6px;
}

.secciones-container::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.secciones-container::-webkit-scrollbar-thumb {
  background: var(--primary-color);
  border-radius: 10px;
  opacity: 0.7;
}

.secciones-container::-webkit-scrollbar-thumb:hover {
  background: var(--secondary-color);
}

/* Actualizar el contenedor de secciones */
.secciones-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  max-height: 45px;
  overflow-y: auto;
  padding: 4px 8px;
  scrollbar-width: thin;
  scrollbar-color: var(--primary-color) #f1f1f1;
}

/* Mejorar el wrapper */
.secciones-wrapper {
  background: #ffffff;
  border-radius: 8px;
  padding: 8px;
  border: 1px solid #dee2e6;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
}

.secciones-container {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  max-height: 50px;
  overflow-y: auto;
  padding: 4px;
}

.seccion-check {
  flex: 0 0 auto;
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  padding: 6px 12px;
  margin: 0;
  transition: all 0.3s ease;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  max-width: 31%;
}



.seccion-check:hover {
  border-color: var(--primary-color);
  transform: translateY(-2px);
  box-shadow: 0 2px 8px rgba(67, 97, 238, 0.1);
}

.seccion-check input {
  margin-right: 6px;
}

.seccion-check label {
  margin: 0;
  cursor: pointer;
  font-size: 0.9rem;
}
.seccion-check.selected {
  background-color: rgba(67, 97, 238, 0.1);
  border-color: var(--primary-color);
}

/* Estilos para el paso 6 de evaluación  */
    .evaluation-card {
      cursor: pointer;
      transition: all 0.3s ease;
      height: 100%;
      border: 2px solid #ddd;
    }
    .evaluation-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.2);
    }
    .evaluation-card.selected {
      background-color: rgba(67, 97, 238, 0.1);
      border-color: var(--primary-color);
    }
    .evaluation-card i {
      font-size: 2rem;
      color: var(--primary-color);
    }
    .criteria-list {
      text-align: left;
      border-top: 1px solid #dee2e6;
      padding-top: 1rem;
    }
    .instrument-card {
      height: 100%;
      transition: all 0.3s ease;
      border: 2px solid #ddd;
    }
    .instrument-card:hover {
      box-shadow: 0 5px 15px rgba(67, 97, 238, 0.1);
    }
    .instrument-card h6 {
      color: var(--primary-color);
      margin-bottom: 1rem;
    }
    .instrument-option {
      transition: all 0.2s ease;
      padding: 0.5rem;
      border-radius: 4px;
    }
    .instrument-option:hover {
      background-color: rgba(67, 97, 238, 0.05);
    }
    .add-criteria-section, .add-instrument-section {
      margin-top: 1rem;
      padding-top: 0.5rem;
      border-top: 1px dashed #dee2e6;
    }
    .custom-criteria-item, .custom-instrument-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .delete-item {
      cursor: pointer;
      color: #dc3545;
      margin-left: 10px;
      opacity: 0.7;
      transition: all 0.2s ease;
    }
    .delete-item:hover {
      opacity: 1;
      transform: scale(1.1);
    }

/* ESTILOS PARA EL PASO 2 REESTRUCTURADO - AGREGAR AL CSS EXISTENTE */

/* Secciones principales del currículum */
.curriculum-section {
  background: white;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  margin-bottom: 1.5rem;
  transition: all 0.3s ease;
  overflow: hidden;
  position: relative;
}

.curriculum-section:hover {
  border-color: var(--primary-color);
  box-shadow: 0 5px 20px rgba(13, 55, 87, 0.1);
}

.curriculum-section.completed {
  border-color: var(--success-color);
}

/* Headers de sección */
.section-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1rem 1.5rem;
  display: flex;
  align-items: center;
  border-bottom: 1px solid #dee2e6;
  font-weight: 600;
  color: var(--primary-color);
}

.section-header i {
  margin-right: 12px;
  font-size: 1.2rem;
  color: var(--secondary-color);
}

.section-header span {
  flex: 1;
}

.completion-indicator {
  color: var(--success-color);
  font-size: 1.1rem;
}

.section-content {
  padding: 1.5rem;
}

/* Grid de competencias */
.competency-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.competency-card {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 2px solid #dee2e6;
  border-radius: 8px;
  padding: 15px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  min-height: 80px;
  display: flex;
  align-items: center;
  text-align: center;
  font-size: 0.95rem;
  line-height: 1.4;
}

.competency-card:hover {
  border-color: var(--primary-color);
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(13, 55, 87, 0.15);
}

.competency-card.selected {
  background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(76, 201, 240, 0.1) 100%);
  border-color: var(--secondary-color);
  color: var(--primary-color);
  font-weight: 500;
}

.competency-card .check-icon {
  position: absolute;
  top: 8px;
  right: 8px;
  color: var(--success-color);
  font-size: 1.1rem;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.competency-card.selected .check-icon {
  opacity: 1;
}

.competency-card.custom {
  border-style: dashed;
  border-color: var(--accent-color);
  background: linear-gradient(135deg, rgba(76, 201, 240, 0.05) 0%, rgba(76, 201, 240, 0.1) 100%);
}

/* Sección de agregar competencias */
.add-competency-section {
  border-top: 1px dashed #dee2e6;
  padding-top: 1rem;
}

/* Tabs de contenidos */
.content-tabs {
  margin-top: 1rem;
}

.content-nav-tabs {
  border: none;
  margin-bottom: 0;
}

.content-nav-tabs .nav-link {
  border: 2px solid #dee2e6;
  border-radius: 8px 8px 0 0;
  margin-right: 5px;
  color: var(--primary-color);
  font-weight: 500;
  position: relative;
  padding: 12px 20px;
}

.content-nav-tabs .nav-link.active {
  background: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

.content-nav-tabs .nav-link:hover {
  border-color: var(--primary-color);
}

.content-count {
  display: inline-block;
  background: rgba(255, 255, 255, 0.3);
  color: inherit;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 0.8rem;
  margin-left: 8px;
  min-width: 24px;
  text-align: center;
}

.content-nav-tabs .nav-link.active .content-count {
  background: rgba(255, 255, 255, 0.2);
  color: white;
}

.content-tab-content {
  background: #f8f9fa;
  border: 2px solid #dee2e6;
  border-radius: 0 8px 8px 8px;
  padding: 20px;
  min-height: 180px;
}

.content-input-area {
  margin-bottom: 15px;
}

.content-input-area .input-group {
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

/* Tags de contenidos */
.content-tags-area {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  min-height: 60px;
  padding: 10px;
  background: white;
  border-radius: 6px;
  border: 1px solid #dee2e6;
}

.content-tag {
  display: inline-flex;
  align-items: center;
  background: var(--primary-color);
  color: white;
  padding: 8px 12px;
  border-radius: 20px;
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.content-tag:hover {
  background: var(--secondary-color);
  transform: translateY(-1px);
}

.content-tag .remove-tag {
  margin-left: 8px;
  cursor: pointer;
  opacity: 0.8;
  font-weight: bold;
}

.content-tag .remove-tag:hover {
  opacity: 1;
  transform: scale(1.2);
}

/* Área de indicadores */
.indicators-area {
  background: #f8f9fa;
  border-radius: 8px;
  padding: 20px;
  border: 1px solid #dee2e6;
}

.indicator-item {
  background: white;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  padding: 12px 15px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  transition: all 0.3s ease;
  cursor: pointer;
}

.indicator-item:hover {
  border-color: var(--primary-color);
  box-shadow: 0 2px 5px rgba(13, 55, 87, 0.1);
}

.indicator-item.selected {
  background: rgba(33, 150, 243, 0.1);
  border-color: var(--secondary-color);
  font-weight: 500;
}

.indicator-item input[type="checkbox"] {
  margin-right: 10px;
  transform: scale(1.2);
}

.indicator-item.custom {
  border-style: dashed;
  border-color: var(--accent-color);
}

.add-indicator-section {
  border-top: 1px dashed #dee2e6;
  padding-top: 1rem;
}

/* Estados vacíos */
.empty-state {
  text-align: center;
  padding: 40px 20px;
  color: #6c757d;
}

.empty-state i {
  font-size: 3rem;
  margin-bottom: 15px;
  opacity: 0.5;
}

.empty-state p {
  margin: 0;
  font-style: italic;
}

/* Animaciones */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.competency-card,
.content-tag,
.indicator-item {
  animation: slideInUp 0.3s ease;
}

/* Responsive */
@media (max-width: 768px) {
  .competency-grid {
    grid-template-columns: 1fr;
  }
  
  .section-header {
    padding: 1rem;
    font-size: 0.95rem;
  }
  
  .section-content {
    padding: 1rem;
  }
  
  .content-nav-tabs .nav-link {
    padding: 10px 15px;
    font-size: 0.9rem;
  }
}

.modal-backdrop.show {
          display: none !important;
        }

        .sugerencias-contenido {
  background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%) !important;
  border: 2px dashed #2196F3 !important;
  border-radius: 10px !important;
}

.sugerencia-btn {
  font-size: 0.85rem;
  padding: 5px 10px;
  border-radius: 15px;
  transition: all 0.3s ease;
}

.sugerencia-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
}

.sugerencia-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.content-tag {
  animation: slideInRight 0.3s ease;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Estilos para el nuevo selector de materias */
.subject-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 15px;
  margin-top: 15px;
}

.subject-card {
  background: white;
  border: 2px solid #dee2e6;
  border-radius: 12px;
  padding: 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  min-height: 40px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.subject-card:hover {
  border-color: var(--primary-color);
  transform: translateY(-3px);
  box-shadow: 0 5px 15px rgba(13, 55, 87, 0.15);
}

.subject-card.selected {
  background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(76, 201, 240, 0.1) 100%);
  border-color: var(--secondary-color);
}

.subject-card .subject-info {
  flex: 1;
}

.subject-card .subject-name {
  font-weight: 600;
  color: var(--primary-color);
  margin-bottom: 5px;
}

.subject-card .subject-icon {
  font-size: 1.5rem;
  color: var(--primary-color);
  margin-right: 15px;
}

.subject-card .check-icon {
  position: absolute;
  top: 10px;
  right: 10px;
  color: var(--success-color);
  font-size: 1.2rem;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.subject-card.selected .check-icon {
  opacity: 1;
}

.custom-subject-section {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px dashed #dee2e6;
}

/* Estilos para Competencias Fundamentales - Diseño Mejorado */
.fundamental-competencies-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: space-between;
  padding: 15px 0;
}

.fundamental-competency-card {
  background: #ffffff;
  border: 2px solid #e0e0e0;
  border-radius: 16px;
  padding: 25px 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 0 1 calc(33.333% - 15px);
  min-width: 320px;
  display: flex;
  align-items: center;
  height: 75px;
  position: relative;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.fundamental-competency-card:hover {
  border-color: #2196F3;
  background: #f8f9fa;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(33, 150, 243, 0.15);
}

.fundamental-competency-card.selected {
  background: #E3F2FD;
  border-color: #2196F3;
  box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
}

.fundamental-competency-card input[type="checkbox"] {
  width: 22px;
  height: 22px;
  margin-right: 20px;
  flex-shrink: 0;
  cursor: pointer;
  accent-color: #2196F3;
}

.fundamental-competency-card label {
  margin: 0;
  cursor: pointer;
  font-size: 1rem;
  color: #333;
  font-weight: 400;
  line-height: 1.5;
  flex: 1;
}

.fundamental-competency-card.selected label {
  color: #1565C0;
  font-weight: 500;
}

/* Alert info mejorado */
.competencies-info-alert {
  background: #cff4fc;
  border: none;
  color: #317683;
  border-radius: 12px;
  padding: 18px 24px;
  margin-bottom: 10px;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
}

.competencies-info-alert i {
  color: #1976D2;
  font-size: 1.1rem;
  margin-right: 12px;
}

/* Header de sección mejorado para competencias fundamentales */
#competencias-fundamentales-section .section-header {
  background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
  padding: 1.2rem 1.5rem;
  border-bottom: 2px solid #e0e0e0;
}

#competencias-fundamentales-section .section-header i {
  color: #2196F3;
}

/* Responsive mejorado */
@media (max-width: 1200px) {
  .fundamental-competency-card {
    flex: 0 1 calc(50% - 10px);
    min-width: 280px;
  }
}

@media (max-width: 768px) {
  .fundamental-competencies-container {
    gap: 15px;
  }
  
  .fundamental-competency-card {
    flex: 0 1 100%;
    min-width: unset;
    padding: 20px 25px;
  }
  
  .fundamental-competency-card input[type="checkbox"] {
    margin-right: 15px;
  }
}

/* Animación de selección */
.fundamental-competency-card {
  position: relative;
  overflow: hidden;
}

.fundamental-competency-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(33, 150, 243, 0.1), transparent);
  transition: left 0.5s ease;
}

.fundamental-competency-card.selected::before {
  left: 100%;
}

/* Animación del checkbox */
.fundamental-competency-card input[type="checkbox"] {
  transition: transform 0.2s ease;
}

.fundamental-competency-card input[type="checkbox"]:checked {
  transform: scale(1.1);
}
.fundamental-competency-card {
  background: #ffffff;
  border: 2px solid #e0e0e0;
  border-radius: 16px;
  padding: 25px 30px;
  cursor: pointer;
  transition: all 0.3s ease;
  flex: 0 1 calc(33.333% - 15px);
  min-width: 320px;
  display: flex;
  align-items: center;
  position: relative; /* Importante para posicionar el check */
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

/* Estilo para el ícono de check */
.fundamental-competency-card .check-icon {
  position: absolute;
  top: 22px;
  right: 20px;
  background: #4CAF50;
  color: white;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  opacity: 0;
  transform: scale(0.8);
  transition: all 0.3s ease;
}

.fundamental-competency-card.selected .check-icon {
  opacity: 1;
  transform: scale(1);
}

.fundamental-competency-card label {
  margin: 0;
  cursor: pointer;
  font-size: 1rem;
  color: #333;
  font-weight: 400;
  line-height: 1.5;
  flex: 1;
  padding-right: 40px; 
}
/* Estilos para la nueva estructura de 3 columnas */
.curriculum-grid-section {
  background: white;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  margin-bottom: 1.5rem;
  overflow: hidden;
}

.curriculum-grid-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1rem 1.5rem;
  border-bottom: 2px solid #dee2e6;
  font-weight: 600;
  color: var(--primary-color);
}

.curriculum-grid-content {
  display: grid;
  grid-template-columns: 1fr 1fr 1fr;
  min-height: 400px;
}

.grid-column {
  padding: 1.5rem;
  border-right: 2px solid #e9ecef;
  position: relative;
}

.grid-column:last-child {
  border-right: none;
}

.grid-column-header {
  background: #f8f9fa;
  margin: -1.5rem -1.5rem 1rem -1.5rem;
  padding: 1rem 1.5rem;
  border-bottom: 2px solid #e0e0e0;
  font-weight: 600;
  color: var(--primary-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.grid-column-header i {
  color: var(--secondary-color);
  margin-right: 8px;
}

.grid-column-content {
  max-height: 350px;
  overflow-y: auto;
  padding-right: 10px;
}

.grid-column-content::-webkit-scrollbar {
  width: 6px;
}

.grid-column-content::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.grid-column-content::-webkit-scrollbar-thumb {
  background: var(--primary-color);
  border-radius: 10px;
}

/* Estilos para items en las columnas */
.grid-item {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 6px;
  padding: 10px 12px;
  margin-bottom: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 0.9rem;
}

.grid-item:hover {
  background: #e9ecef;
  border-color: var(--primary-color);
  transform: translateX(3px);
}

.grid-item.selected {
  background: #E3F2FD;
  border-color: var(--secondary-color);
  font-weight: 500;
}

.grid-item .check-icon {
  float: right;
  color: var(--success-color);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.grid-item.selected .check-icon {
  opacity: 1;
}

/* Input para agregar items */
.add-item-input {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px dashed #dee2e6;
}

.add-item-input .input-group {
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Tags de contenidos en la nueva estructura */
.content-type-section {
  margin-bottom: 20px;
}

.content-type-header {
  font-size: 0.9rem;
  font-weight: 600;
  color: #6c757d;
  margin-bottom: 8px;
  display: flex;
  align-items: center;
}

.content-type-header i {
  margin-right: 6px;
  font-size: 0.8rem;
}

.content-tags-compact {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.content-tag-compact {
  background: var(--primary-color);
  color: white;
  padding: 4px 10px;
  border-radius: 15px;
  font-size: 0.85rem;
  display: inline-flex;
  align-items: center;
}

.content-tag-compact .remove-tag {
  margin-left: 6px;
  cursor: pointer;
  font-weight: bold;
  opacity: 0.8;
}

.content-tag-compact .remove-tag:hover {
  opacity: 1;
}

/* Responsive */
@media (max-width: 992px) {
  .curriculum-grid-content {
    grid-template-columns: 1fr;
  }
  
  .grid-column {
    border-right: none;
    border-bottom: 2px solid #e9ecef;
  }
  
  .grid-column:last-child {
    border-bottom: none;
  }
}
/* Estilos para el control de duración */
.duration-controls {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.duration-btn-up,
.duration-btn-down {
  height: 50%;
  width: 35px;
  padding: 0;
  border-radius: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  transition: all 0.2s ease;
  border-color: #ddd;
  flex: 1;
}

.duration-btn-up {
  border-top-right-radius: 8px;
  border-bottom: 1px solid #ddd;
}

.duration-btn-down {
  border-bottom-right-radius: 8px;
  border-top: none;
}

.duration-btn-up:hover,
.duration-btn-down:hover {
  background-color: var(--primary-color);
  color: white;
  border-color: var(--primary-color);
}

.duration-btn-up:active,
.duration-btn-down:active {
  transform: scale(0.95);
}

#actDuration {
  font-weight: normal;
  font-size: 1rem;
  background-color: white;
  border-right: none;
  border: 2px solid #ddd;
  padding: 0.75rem 1rem;
  height: 58px; /* Altura específica para coincidir */
}

#actDuration:focus {
  border-color: var(--primary-color);
  box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
  background-color: white;
}

.input-group .form-control:not(:last-child) {
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}

.input-group .duration-controls {
  height: 58px; /* Misma altura que el input */
}

/* CENTRAR TODOS LOS CHECKBOXES */
input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
}

/* Para checkboxes dentro de form-check */
.form-check-input {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
}

/* Para competencias fundamentales */
.fundamental-competency-card input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
  margin-right: 20px !important;
}

/* Para indicadores */
.indicator-item input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
  margin-right: 10px !important;
}

/* Para elementos de evaluación */
.evaluation-card input[type="checkbox"],
.instrument-card input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
}
/* CENTRAR CHECKBOXES VERTICALMENTE */
.fundamental-competency-card {
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
}

.fundamental-competency-card input[type="checkbox"] {
  margin-right: 20px !important;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  align-self: center !important;
}

.grid-item {
  display: flex !important;
  align-items: center !important;
  justify-content: flex-start !important;
}

.grid-item input[type="checkbox"] {
  margin-right: 10px !important;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  align-self: center !important;
}

/* Para cualquier contenedor con checkbox */
.form-check {
  display: flex !important;
  align-items: center !important;
}

.form-check-input {
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  align-self: center !important;
}
/* CENTRAR TODOS LOS CHECKBOXES */
input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
}

/* Para checkboxes dentro de form-check */
.form-check-input {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
}

/* Para competencias fundamentales */
.fundamental-competency-card input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
  margin-right: 20px !important;
}

/* Para indicadores */
.indicator-item input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
  margin-right: 10px !important;
}

/* Para elementos de evaluación */
.evaluation-card input[type="checkbox"],
.instrument-card input[type="checkbox"] {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 auto !important;
}
/* Para los elementos sin checkbox visible */
.grid-item {
  display: flex !important;
  align-items: center !important;
  padding: 10px 12px !important;
}

/* Para los indicadores de la derecha */
.indicator-item {
  display: flex !important;
  align-items: center !important;
  padding: 12px 15px !important;
}

/* Si hay checkboxes ocultos, mostrarlos */
.grid-item input[type="checkbox"],
.indicator-item input[type="checkbox"] {
  display: inline-block !important;
  margin-right: 10px !important;
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  vertical-align: middle !important;
}

/* Para elementos que actúan como checkboxes pero no lo son */
.grid-item::before {
  content: "☐" !important;
  margin-right: 10px !important;
  font-size: 16px !important;
  color: #6c757d !important;
}

.grid-item.selected::before {
  content: "☑" !important;
  color: var(--success-color) !important;
}

  </style>
</head>
<body>
  <div class="wizard-container animate__animated animate__fadeIn">
    <!--  -->
    <div class="wizard-header d-flex justify-content-center">
      <i class="fas fa-arrow-up arrow-nav arrow-up mb-5" id="btn-prev"></i>
    </div>
    <!--  -->
    <div class="wizard-body">
        <!--  -->

<div class="wizard-card wizard-step active animated-element" id="step1">
  <h4 class="step-title">
    <i class="fas fa-clipboard-list me-2"></i>
    Paso 1: Contexto de la Planificación
  </h4>
  
  <div class="row">
    <div class="col-md-6">
      <!-- Nuevo campo: Nombre de la planificación -->
      <div class="form-group field-complete">
        <label class="form-label">
          <i class="fas fa-heading"></i>
          Nombre de la planificación
        </label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-file-signature"></i></span>
          <input type="text" class="form-control" id="nombrePlanificacion" name="nombrePlanificacion" required 
                 placeholder="Ingrese un nombre descriptivo">
          <i class="fas fa-check-circle completion-icon"></i>
        </div>
      </div>

      <!-- Nuevo campo: Tipo de planificación -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-tasks"></i>
          Tipo de planificación
        </label>
        <div class="input-group">
          <span class="input-group-text"><i class="fas fa-list-alt"></i></span>
          <select class="form-select" id="tipoPlanificacion" name="tipoPlanificacion" required>
            <option value="" selected disabled>Seleccione el tipo</option>
            <option value="unidad">Unidad didáctica</option>
            <option value="proyecto">Proyecto educativo</option>
            <option value="taller">Taller</option>
            <option value="clase">Plan de clase</option>
            <option value="otro">Otro tipo...</option>
          </select>
          <i class="fas fa-check-circle completion-icon"></i>
        </div>
        <div id="tipoPlanificacionOtro" class="mt-2 d-none">
          <input type="text" class="form-control" placeholder="Especifique el tipo">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-layer-group"></i>
          Nivel y Grado 
        </label>
        <!-- Mantener el contenido existente del selector de grado -->
        <div class="row grado-selector">
    <div class="col-4">
      <div class="card nivel-card" data-value="preescolar">
        <div class="card-body text-center">
          <i class="fas fa-child mb-2"></i>
          <p class="mb-0">Preescolar</p>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="card nivel-card" data-value="primaria">
        <div class="card-body text-center">
          <i class="fas fa-school mb-2"></i>
          <p class="mb-0">Primaria</p>
        </div>
      </div>
    </div>
    <div class="col-4">
      <div class="card nivel-card" data-value="secundaria">
        <div class="card-body text-center">
          <i class="fas fa-user-graduate mb-2"></i>
          <p class="mb-0">Secundaria</p>
        </div>
      </div>
    </div>
        </div>
        <input type="hidden" name="grado" id="gradoInput" required>
        <div id="nivelDetalle" class="mt-3 d-none">
          <select class="form-select" id="gradoDetalle">
          </select>
        </div>
      </div>
    </div>
    
    <div class="col-md-6">
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-calendar-alt"></i>
          Fechas (inicio - fin)
        </label>
        <input type="text" class="form-control" id="fechas" name="fechas" placeholder="Seleccione el rango de fechas">
        <i class="fas fa-check-circle completion-icon" style="margin-top: 1rem;"></i>
      </div>
      
      <!-- Mantener la sección de secciones/técnicos -->
      <div class="form-group">
        <div id="seccionesTecnicos" class="d-none">
          <label class="form-label mb-2">
            <i class="fas fa-users"></i>
            Secciones / Técnicos
          </label>
          <div class="secciones-wrapper">
            <div class="secciones-container">
              <!-- Se llenará dinámicamente -->
            </div>
          </div>
        </div>
      </div>

      <!-- Nuevo campo: Comentario -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-comment"></i>
          Comentario
        </label>
        <textarea class="form-control" id="comentario" name="comentario" style="height: 10rem;" 
                  placeholder="Agregue información adicional relevante..."></textarea>
      </div>
    </div>
  </div>
</div>

    <!-- PASO 2 REESTRUCTURADO - REEMPLAZAR EL DIV step2 EXISTENTE -->
<div class="wizard-card wizard-step animated-element" id="step2">
  <h4 class="step-title">
    <i class="fas fa-book-open me-2"></i>
    Paso 2: Aspectos Curriculares
  </h4>
  
  <!-- Sección 1: Área o Asignatura -->
  <div class="curriculum-section" id="area-section">
  <div class="section-header">
    <i class="fas fa-graduation-cap"></i>
    <span>Área o Asignatura</span>
    <div class="completion-indicator d-none">
      <i class="fas fa-check-circle completion-icon"></i>
    </div>
  </div>
  <div class="section-content">
    <div class="alert alert-info mb-3">
      <i class="fas fa-info-circle me-1"></i>
      Seleccione el área curricular para esta planificación
    </div>
    
    <div class="subject-grid" id="subjectGrid">
      <!-- Matemáticas -->
      <div class="subject-card" data-value="matematicas">
        <i class="fas fa-calculator subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Matemáticas</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Lengua Española -->
      <div class="subject-card" data-value="lenguaje">
        <i class="fas fa-book subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Lengua Española</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Ciencias Naturales -->
      <div class="subject-card" data-value="ciencias_naturales">
        <i class="fas fa-flask subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Ciencias Naturales</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Ciencias Sociales -->
      <div class="subject-card" data-value="ciencias_sociales">
        <i class="fas fa-globe-americas subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Ciencias Sociales</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Educación Artística -->
      <div class="subject-card" data-value="educacion_artistica">
        <i class="fas fa-palette subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Educación Artística</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Educación Física -->
      <div class="subject-card" data-value="educacion_fisica">
        <i class="fas fa-running subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Educación Física</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Formación Humana -->
      <div class="subject-card" data-value="formacion_humana">
        <i class="fas fa-heart subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">F.I.H.R</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Inglés -->
      <div class="subject-card" data-value="ingles">
        <i class="fas fa-language subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Inglés</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Francés -->
      <div class="subject-card" data-value="frances">
        <i class="fas fa-flag-usa subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Francés</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
      
      <!-- Educación Técnica -->
      <div class="subject-card" data-value="educacion_tecnica">
        <i class="fas fa-cogs subject-icon"></i>
        <div class="subject-info">
          <div class="subject-name">Educación Técnica</div>
        </div>
        <i class="fas fa-check-circle check-icon"></i>
      </div>
    </div>
        
    
    <input type="hidden" id="areaSeleccionada" name="areaAsignatura">
  </div>
</div>

<!-- Sección de Competencias Fundamentales -->
<div class="curriculum-section" id="competencias-fundamentales-section">
  <div class="section-header">
    <i class="fas fa-star"></i>
    <span>Competencias Fundamentales</span>
    <div class="completion-indicator d-none">
      <i class="fas fa-check-circle completion-icon"></i>
    </div>
  </div>
  <div class="section-content">
    <div class="alert competencies-info-alert">
      <i class="fas fa-info-circle"></i>
      <span>Seleccione las competencias fundamentales que se trabajarán en esta planificación</span>
    </div>
    
    <div class="fundamental-competencies-container">
      <!-- Competencia Ética y Ciudadana -->
      <div class="fundamental-competency-card" data-id="etica_ciudadana">
        <input type="checkbox" class="form-check-input" id="comp_etica">
        <label class="form-check-label" for="comp_etica">
          Competencia Ética y Ciudadana
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
      
      <!-- Competencia Comunicativa -->
      <div class="fundamental-competency-card" data-id="comunicativa">
        <input type="checkbox" class="form-check-input" id="comp_comunicativa">
        <label class="form-check-label" for="comp_comunicativa">
          Competencia Comunicativa
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
      
      <!-- Competencia Pensamiento Lógico, Creativo y Crítico -->
      <div class="fundamental-competency-card" data-id="pensamiento">
        <input type="checkbox" class="form-check-input" id="comp_pensamiento">
        <label class="form-check-label" for="comp_pensamiento">
          Competencia Pensamiento Lógico, Creativo y Crítico
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
      
      <!-- Competencia Resolución de Problemas -->
      <div class="fundamental-competency-card" data-id="resolucion">
        <input type="checkbox" class="form-check-input" id="comp_resolucion">
        <label class="form-check-label" for="comp_resolucion">
          Competencia Resolución de Problemas
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
      
      <!-- Competencia Científica y Tecnológica -->
      <div class="fundamental-competency-card" data-id="cientifica">
        <input type="checkbox" class="form-check-input" id="comp_cientifica">
        <label class="form-check-label" for="comp_cientifica">
          Competencia Científica y Tecnológica
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
      
      <!-- Competencia Ambiental y de la Salud -->
      <div class="fundamental-competency-card" data-id="ambiental">
        <input type="checkbox" class="form-check-input" id="comp_ambiental">
        <label class="form-check-label" for="comp_ambiental">
          Competencia Ambiental y de la Salud
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
      
      <!-- Competencia Desarrollo Personal y Espiritual -->
      <div class="fundamental-competency-card" data-id="desarrollo">
        <input type="checkbox" class="form-check-input" id="comp_desarrollo">
        <label class="form-check-label" for="comp_desarrollo">
          Competencia Desarrollo Personal y Espiritual
        </label>
        <div class="check-icon">
          <i class="fas fa-check"></i>
        </div>
      </div>
    </div>
    
    <input type="hidden" id="competenciasFundamentalesSeleccionadas" name="competenciasFundamentales">
  </div>
</div>

  <!-- Sección unificada de Competencias, Contenidos e Indicadores -->
<div class="curriculum-grid-section" id="curriculum-grid-section">
  <div class="curriculum-grid-header">
    
  </div>
  
  <div class="curriculum-grid-content">
    <!-- Columna 1: Competencias Específicas -->
    <div class="grid-column">
      <div class="grid-column-header">
        <span><i class="fas fa-trophy"></i>Competencias Específicas</span>
        <span class="badge bg-secondary" id="competencias-count">0</span>
      </div>
      <div class="grid-column-content" id="competenciasGridColumn">
        <div class="empty-state">
          <i class="fas fa-graduation-cap"></i>
          <p>Seleccione un área para ver las competencias</p>
        </div>
      </div>
      <div class="add-item-input">
        <div class="input-group input-group-sm">
          <input type="text" class="form-control" id="nuevaCompetenciaGrid" 
                 placeholder="Agregar competencia personalizada...">
          <button class="btn btn-primary" type="button" id="btnAgregarCompetenciaGrid">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Columna 2: Contenidos -->
    <div class="grid-column">
      <div class="grid-column-header">
        <span><i class="fas fa-list-ul"></i>Contenidos</span>
        <span class="badge bg-secondary" id="contenidos-count">0</span>
      </div>
      <div class="grid-column-content" id="contenidosGridColumn">
        <!-- Conceptuales -->
        <div class="content-type-section">
          <div class="content-type-header">
            <i class="fas fa-brain"></i>Conceptuales
          </div>
          <div class="content-tags-compact" id="conceptualesCompact"></div>
          <div class="input-group input-group-sm mt-2">
            <input type="text" class="form-control" id="inputConceptualCompact" 
                   placeholder="Agregar contenido conceptual...">
            <button class="btn btn-outline-primary btn-sm" type="button" 
                    onclick="agregarContenidoCompact('conceptual')">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
        
        <!-- Procedimentales -->
        <div class="content-type-section">
          <div class="content-type-header">
            <i class="fas fa-cogs"></i>Procedimentales
          </div>
          <div class="content-tags-compact" id="procedimentalesCompact"></div>
          <div class="input-group input-group-sm mt-2">
            <input type="text" class="form-control" id="inputProcedimentalCompact" 
                   placeholder="Agregar contenido procedimental...">
            <button class="btn btn-outline-primary btn-sm" type="button" 
                    onclick="agregarContenidoCompact('procedimental')">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
        
        <!-- Actitudinales -->
        <div class="content-type-section">
          <div class="content-type-header">
            <i class="fas fa-heart"></i>Actitudinales
          </div>
          <div class="content-tags-compact" id="actitudinalesCompact"></div>
          <div class="input-group input-group-sm mt-2">
            <input type="text" class="form-control" id="inputActitudinalCompact" 
                   placeholder="Agregar contenido actitudinal...">
            <button class="btn btn-outline-primary btn-sm" type="button" 
                    onclick="agregarContenidoCompact('actitudinal')">
              <i class="fas fa-plus"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Columna 3: Indicadores -->
    <div class="grid-column">
      <div class="grid-column-header">
        <span><i class="fas fa-bullseye"></i>Indicadores de Logro</span>
        <span class="badge bg-secondary" id="indicadores-count">0</span>
      </div>
      <div class="grid-column-content" id="indicadoresGridColumn">
        <div class="empty-state">
          <i class="fas fa-bullseye"></i>
          <p>Los indicadores se generarán automáticamente</p>
        </div>
      </div>
      <div class="add-item-input">
        <div class="input-group input-group-sm">
          <input type="text" class="form-control" id="nuevoIndicadorGrid" 
                 placeholder="Agregar indicador personalizado...">
          <button class="btn btn-primary" type="button" id="btnAgregarIndicadorGrid">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Campos ocultos para mantener compatibilidad -->
<input type="hidden" id="competenciasSeleccionadas" name="competenciasEspecificas">
<input type="hidden" id="contenidosSeleccionados" name="contenidos">
<input type="hidden" id="indicadoresSeleccionados" name="indicadoresLogro">

</div>


<div class="wizard-card wizard-step animated-element" id="step3">
  <h4 class="step-title">
    <i class="fas fa-list-ol me-2"></i>
    Paso 3: Secuencias Didácticas y Recursos
  </h4>

  <div class="row">
    <div class="col-md-12">
      <!-- SECCIÓN DE ACTIVIDADES (MANTENER LO EXISTENTE) -->
      <div class="form-group mb-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <label class="form-label">
            <i class="fas fa-tasks"></i>
            Actividades de la Planificación
          </label>
        </div>

        <!-- Formulario embebido para agregar actividades -->
        <div id="activityFormContainer" class="mb-4">
          <div class="card p-4 border border-primary-subtle shadow-sm">
            <!-- Fila 1: Título y Duración -->
            <div class="row mb-3">
              <div class="col-8">
                <label class="form-label fw-bold">
                  <i class="fas fa-heading me-2 text-primary"></i>Título *
                </label>
                <input type="text" class="form-control form-control-lg" id="actTitle" required 
                       placeholder="Ej: Introducción a las fracciones">
              </div>
              <div class="col-4">
  <label class="form-label fw-bold">
    <i class="fas fa-clock me-2 text-primary"></i>Duración (min) *
  </label>
  <div class="input-group">
    <input type="number" class="form-control text-center" id="actDuration" required
           min="0" max="240" step="5" value="0" placeholder="0" readonly>
    <div class="input-group-append">
      <div class="btn-group-vertical duration-controls">
        <button class="btn btn-outline-secondary btn-sm duration-btn-up" type="button">
          <i class="fas fa-chevron-up"></i>
        </button>
        <button class="btn btn-outline-secondary btn-sm duration-btn-down" type="button">
          <i class="fas fa-chevron-down"></i>
        </button>
      </div>
    </div>
  </div>
</div>

            <!-- Fila 2: Estrategia metodológica y Tipo -->
           <div class="row mb-3 my-4">
              <div class="col-8">
                <label class="form-label fw-bold">
                  <i class="fas fa-lightbulb me-2 text-warning"></i>Estrategia metodológica *
                </label>
                <select class="form-select form-select-lg" id="actMethod" required>
                  <option value="">Seleccionar estrategia</option>
                  <option value="expositiva">
                    <i class="fas fa-chalkboard-teacher"></i> Clase expositiva
                  </option>
                  <option value="practica">
                    <i class="fas fa-hands"></i> Práctica dirigida
                  </option>
                  <option value="colaborativa">
                    <i class="fas fa-users"></i> Trabajo colaborativo
                  </option>
                  <option value="investigacion">
                    <i class="fas fa-search"></i> Investigación
                  </option>
                  <option value="debate">
                    <i class="fas fa-comments"></i> Debate y discusión
                  </option>
                  <option value="juego">
                    <i class="fas fa-gamepad"></i> Aprendizaje basado en juegos
                  </option>
                  <option value="proyecto">
                    <i class="fas fa-project-diagram"></i> Aprendizaje por proyectos
                  </option>
                </select>
              </div>
              <div class="col-4">
                <label class="form-label fw-bold">
                  <i class="fas fa-tag me-2 text-info"></i>Tipo de Actividad *
                </label>
                <select class="form-select form-select-lg" id="actType" required>
                  <option value="">Seleccionar tipo</option>
                  <option value="inicio">
                    <i class="fas fa-play-circle text-success"></i> Regular
                  </option>
                  <option value="evaluacion">
                    <i class="fas fa-clipboard-check text-danger"></i> Evaluación
                  </option>
                </select>
              </div>
            </div>

            <!-- Fila 3: Descripción -->
            <div class="mb-3">
              <label class="form-label fw-bold">
                <i class="fas fa-align-left me-2 text-secondary"></i>Descripción *
              </label>
              <textarea class="form-control" id="actDescription" rows="4" required 
                        placeholder="Describe detalladamente qué se realizará en esta actividad, los pasos a seguir y los objetivos específicos..."></textarea>
            </div>
                  <!-- NUEVA SECCIÓN DE RECURSOS DIGITALES -->
      <div class="form-group mt-5">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <label class="form-label">
            <i class="fas fa-toolbox"></i>
            Recursos Didácticos Digitales
          </label>
        </div>
        
<!-- Botones de recursos en grid -->
        <div class="row g-3 justify-content-center mb-4">
          <!-- YouTube -->
          <div class="col-md-2 col-sm-6">
            <div class="card resource-type-card h-100" data-type="youtube">
              <div class="card-body text-center">
                <i class="fab fa-youtube resource-icon mb-3" style="color: #FF0000;"></i>
                <h6 class="card-title">YouTube</h6>
                <p class="card-text small text-muted">Videos educativos</p>
                <button class="btn btn-outline-primary btn-sm add-resource-btn" data-bs-toggle="modal" data-bs-target="#youtubeModal">
                  <i class="fas fa-plus me-1"></i>Agregar
                </button>
              </div>
            </div>
          </div>

          <!-- Enlaces Web -->
          <div class="col-md-2 col-sm-6">
            <div class="card resource-type-card h-100" data-type="enlace">
              <div class="card-body text-center">
                <i class="fas fa-link resource-icon mb-3" style="color: #0066CC;"></i>
                <h6 class="card-title">Enlaces</h6>
                <p class="card-text small text-muted">Sitios web y recursos online</p>
                <button class="btn btn-outline-primary btn-sm add-resource-btn" data-bs-toggle="modal" data-bs-target="#enlaceModal">
                  <i class="fas fa-plus me-1"></i>Agregar
                </button>
              </div>
            </div>
          </div>

          <!-- Archivos -->
          <div class="col-md-2 col-sm-6">
            <div class="card resource-type-card h-100" data-type="archivo">
              <div class="card-body text-center">
                <i class="fas fa-file-alt resource-icon mb-3" style="color: #28A745;"></i>
                <h6 class="card-title">Archivos</h6>
                <p class="card-text small text-muted">Documentos y materiales</p>
                <button class="btn btn-outline-primary btn-sm add-resource-btn" data-bs-toggle="modal" data-bs-target="#archivoModal">
                  <i class="fas fa-plus me-1"></i>Agregar
                </button>
              </div>
            </div>
          </div>

          <!-- Material Interactivo -->
          <div class="col-md-2 col-sm-6">
            <div class="card resource-type-card h-100" data-type="material">
              <div class="card-body text-center">
                <i class="fas fa-cube resource-icon mb-3" style="color: #FFC107;"></i>
                <h6 class="card-title">Contenido Interactivo</h6>
                <p class="card-text small text-muted">Recursos Varios</p>
                <button class="btn btn-outline-primary btn-sm add-resource-btn" data-bs-toggle="modal" data-bs-target="#materialModal">
                  <i class="fas fa-plus me-1"></i>Agregar
                </button>
              </div>
            </div>
          </div>

          <!-- Biblioteca -->
          <div class="col-md-2 col-sm-6">
            <div class="card resource-type-card h-100" data-type="biblioteca">
              <div class="card-body text-center">
                <i class="fas fa-book resource-icon mb-3" style="color: #6F42C1;"></i>
                <h6 class="card-title">Biblioteca</h6>
                <p class="card-text small text-muted">Recursos bibliotecarios</p>
                <button class="btn btn-outline-primary btn-sm add-resource-btn" data-bs-toggle="modal" data-bs-target="#bibliotecaModal">
                  <i class="fas fa-plus me-1"></i>Agregar
                </button>
              </div>
            </div>
          </div>

          <!-- ABC Nube -->
          <div class="col-md-2 col-sm-6">
            <div class="card resource-type-card h-100" data-type="abc_nube">
              <div class="card-body text-center">
                <i class="fas fa-cloud resource-icon mb-3" style="color: #20C997;"></i>
                <h6 class="card-title">ABC Nube</h6>
                <p class="card-text small text-muted">Recursos en la nube</p>
                <button class="btn btn-outline-primary btn-sm add-resource-btn" data-bs-toggle="modal" data-bs-target="#abcNubeModal">
                  <i class="fas fa-plus me-1"></i>Agregar
                </button>
              </div>
            </div>
          </div>
        </div>
       

        <!-- Lista de recursos agregados -->
        <div class="mt-4">
          <h6 class="text-muted mb-3">
            <i class="fas fa-list me-2"></i>Recursos digitales agregados (<span id="totalRecursos">0</span>)
          </h6>
          <div id="recursosAgregados" class="recursos-list">
            <div class="empty-resources-state text-center p-4">
              <i class="fas fa-folder-open fa-3x text-muted mb-3 opacity-50"></i>
              <p class="text-muted">No hay recursos digitales agregados.</p>
            </div>
          </div>
        </div>
        

        <input type="hidden" id="recursosSeleccionados" name="recursos">
      </div>

            

            <!-- Botón de guardar mejorado -->
            <div class="d-flex justify-content-end">
              <button type="button" class="btn btn-primary btn-lg px-4" id="saveActivity">
                <i class="fas fa-save me-2"></i>Guardar Actividad
              </button>
            </div>
          </div>
        </div>

        <!-- Lista de actividades -->
        <div id="activitiesList" class="border rounded p-3" style="min-height: 200px; background: #f8f9fa;">
          <div class="text-center text-muted">
            <i class="fas fa-clipboard-list fa-2x mb-2 opacity-50"></i>
            <p>No hay actividades. Haga clic en "Agregar Actividad" para comenzar.</p>
          </div>
        </div>
      </div>

      <!-- Lista ordenable -->
      <div class="form-group mb-4" id="ordenContainer" style="display: none;">
        <label class="form-label">
          <i class="fas fa-sort"></i>
          Ordenar Secuencia
        </label>
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>Arrastre para reordenar
        </div>
        <div id="sortableList" class="list-group">
          <!-- Se llena dinámicamente -->
        </div>
      </div>

      <input type="hidden" id="actividadesData" name="actividadesData">


    </div>
  </div>
</div>

<!-- MODALES PARA CADA TIPO DE RECURSO -->

<!-- Modal YouTube -->
<div class="modal" id="youtubeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="fab fa-youtube me-2"></i>Agregar Video de YouTube
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="youtubeForm">
          <div class="mb-3">
            <label class="form-label">Nombre del recurso</label>
            <input type="text" class="form-control" id="youtubeNombre" required placeholder="Ej: Video explicativo sobre fracciones">
          </div>
          <div class="mb-3">
            <label class="form-label">Detalles</label>
            <textarea class="form-control" id="youtubeDetalles" rows="3" placeholder="Descripción del contenido del video..."></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">
              <i class="fab fa-youtube me-1 text-danger"></i>URL del Video (YouTube, Vimeo)
            </label>
            <input type="url" class="form-control" id="youtubeUrl" required placeholder="https://www.youtube.com/watch?v=...">
          </div>
          <div class="mb-3">
            <label class="form-label">Visible a partir de</label>
            <div class="row">
              <div class="col-4">
                <input type="date" class="form-control" id="youtubeFecha">
              </div>
              <div class="col-4">
                <input type="time" class="form-control" id="youtubeHora" value="14:00">
              </div>
              <div class="col-4">
                <input type="number" class="form-control" id="youtubeDias" min="1" max="365" value="26" placeholder="Días">
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha de Entrega</label>
            <input type="date" class="form-control" id="youtubeEntrega">
          </div>
          <div class="mb-3">
            <label class="form-label">Estado</label>
            <select class="form-select" id="youtubeEstado">
              <option value="activo" selected>Activo</option>
              <option value="inactivo">Inactivo</option>
              <option value="programado">Programado</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Cancelar
        </button>
        <button type="button" class="btn btn-danger" id="guardarYoutube">
          <i class="fas fa-check me-1"></i>Publicar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Enlaces -->
<div class="modal fade" id="enlaceModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header" style="background-color: #0066CC; color: white;">
        <h5 class="modal-title">
          <i class="fas fa-link me-2"></i>Agregar Enlace Web
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="enlaceForm">
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" id="enlaceNombre" required placeholder="Ej: Portal educativo de matemáticas">
          </div>
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-link me-1" style="color: #0066CC;"></i>URL
            </label>
            <input type="url" class="form-control" id="enlaceUrl" required placeholder="https://ejemplo.com">
          </div>
          <div class="mb-3">
            <label class="form-label">Visible a partir de</label>
            <div class="row">
              <div class="col-4">
                <input type="date" class="form-control" id="enlaceFecha">
              </div>
              <div class="col-4">
                <input type="time" class="form-control" id="enlaceHora" value="14:00">
              </div>
              <div class="col-4">
                <input type="number" class="form-control" id="enlaceDias" min="1" max="365" value="27" placeholder="Días">
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha de Entrega</label>
            <input type="date" class="form-control" id="enlaceEntrega">
          </div>
          <div class="mb-3">
            <label class="form-label">Estado</label>
            <select class="form-select" id="enlaceEstado">
              <option value="activo" selected>Activo</option>
              <option value="inactivo">Inactivo</option>
              <option value="programado">Programado</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Cancelar
        </button>
        <button type="button" class="btn btn-primary" id="guardarEnlace">
          <i class="fas fa-check me-1"></i>Publicar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Archivos -->
<div class="modal fade" id="archivoModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-success text-white">
        <h5 class="modal-title">
          <i class="fas fa-file-alt me-2"></i>Agregar Archivo
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="archivoForm">
          <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" id="archivoNombre" required placeholder="Ej: Guía de ejercicios">
          </div>
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-cloud-upload-alt me-1 text-success"></i>URL del recurso
            </label>
            <input type="url" class="form-control" id="archivoUrl" required placeholder="https://drive.google.com/...">
          </div>
          <div class="mb-3">
            <label class="form-label">
              <i class="fas fa-cog me-1"></i>Alto del recurso (100, 150, 300 etc...)
            </label>
            <input type="number" class="form-control" id="archivoAlto" min="50" max="1000" value="0" placeholder="Altura en píxeles">
          </div>
          <div class="mb-3">
            <label class="form-label">Visible a partir de</label>
            <div class="row">
              <div class="col-4">
                <input type="date" class="form-control" id="archivoFecha">
              </div>
              <div class="col-4">
                <input type="time" class="form-control" id="archivoHora" value="14:00">
              </div>
              <div class="col-4">
                <input type="number" class="form-control" id="archivoDias" min="1" max="365" value="27" placeholder="Días">
              </div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">Fecha de Entrega</label>
            <input type="date" class="form-control" id="archivoEntrega">
          </div>
          <div class="mb-3">
            <label class="form-label">Estado</label>
            <select class="form-select" id="archivoEstado">
              <option value="activo" selected>Activo</option>
              <option value="inactivo">Inactivo</option>
              <option value="programado">Programado</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Cancelar
        </button>
        <button type="button" class="btn btn-success" id="guardarArchivo">
          <i class="fas fa-check me-1"></i>Publicar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Material Físico -->
<div class="modal fade" id="materialModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">
          <i class="fas fa-cube me-2"></i>Agregar Material Interactivo
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="materialForm">
          <!-- Tipo de material -->
          <div class="mb-3">
            <label class="form-label">Tipo de recurso</label>
            <select class="form-select" id="materialTipo" required>
              <option value="">Seleccionar tipo</option>
              <option value="videojuego">Videojuego educativo</option>
              <option value="simulador">Simulador interactivo</option>
              <option value="aplicacion">Aplicación móvil</option>
              <option value="plataforma">Plataforma educativa</option>
              <option value="fisico">Material físico tradicional</option>
              <option value="otro">Otro</option>
            </select>
          </div>

          <!-- Nombre del material -->
          <div class="mb-3">
            <label class="form-label">Nombre del material</label>
            <input type="text" class="form-control" id="materialNombre" required placeholder="Ej: Minecraft Education, Calculadoras, etc.">
          </div>

          <!-- URL (condicional) -->
          <div class="mb-3" id="materialUrlSection" style="display: none;">
            <label class="form-label">
              <i class="fas fa-link me-1 text-warning"></i>URL del recurso
            </label>
            <input type="url" class="form-control" id="materialUrl" placeholder="https://...">
          </div>

          <!-- Descripción -->
          <div class="mb-3">
            <label class="form-label">Descripción y objetivos</label>
            <textarea class="form-control" id="materialDescripcion" rows="3" placeholder="Describe cómo se usará este recurso y qué habilidades desarrollará..."></textarea>
          </div>

          <!-- Nivel de dificultad (para recursos interactivos) -->
          <div class="mb-3" id="materialNivelSection" style="display: none;">
            <label class="form-label">Nivel de dificultad</label>
            <select class="form-select" id="materialNivel">
              <option value="basico">Básico</option>
              <option value="intermedio">Intermedio</option>
              <option value="avanzado" selected>Avanzado</option>
            </select>
          </div>

          <!-- Tiempo estimado -->
          <div class="mb-3">
            <label class="form-label">Tiempo estimado de uso (minutos)</label>
            <input type="number" class="form-control" id="materialTiempo" min="5" max="180" value="30" placeholder="Tiempo en minutos">
          </div>

          <!-- Cantidad (para materiales físicos) -->
          <div class="mb-3" id="materialCantidadSection" style="display: none;">
            <label class="form-label">Cantidad necesaria</label>
            <input type="number" class="form-control" id="materialCantidad" min="1" value="1" placeholder="Cantidad">
          </div>

          <!-- Disponible desde -->
          <div class="mb-3">
            <label class="form-label">Disponible desde</label>
            <div class="row">
              <div class="col-6">
                <input type="date" class="form-control" id="materialFecha">
              </div>
              <div class="col-6">
                <input type="time" class="form-control" id="materialHora" value="14:00">
              </div>
            </div>
          </div>

          <!-- Estado -->
          <div class="mb-3">
            <label class="form-label">Estado</label>
            <select class="form-select" id="materialEstado">
              <option value="disponible" selected>Disponible</option>
              <option value="pendiente">Pendiente</option>
              <option value="solicitado">Solicitado</option>
              <option value="en_revision">En revisión</option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fas fa-times me-1"></i>Cancelar
        </button>
        <button type="button" class="btn btn-warning" id="guardarMaterial">
          <i class="fas fa-check me-1"></i>Agregar
        </button>
      </div>
    </div>
  </div>
</div>


        <div class="wizard-card wizard-step animated-element" id="step4">
    <h4 class="step-title">
        <i class="fas fa-chalkboard-teacher me-2"></i>
        Paso 4: Métodos y Actividades
    </h4>
    
    <div class="row">
        <div class="col-md-12">
        <div class="form-group">
            <label class="form-label">
            <i class="fas fa-tools"></i>
            Métodos de enseñanza
            </label>
            <div class="row">
            <div class="col-md-4 mb-3">
                <div class="card method-card" data-value="expositivo">
                <div class="card-body text-center">
                    <i class="fa fa-desktop mb-2"></i>
                    <h6>Método Expositivo</h6>
                    <small>Presentación clara y estructurada</small>
                </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card method-card" data-value="colaborativo">
                <div class="card-body text-center">
                    <i class="fas fa-users mb-2"></i>
                    <h6>Aprendizaje Colaborativo</h6>
                    <small>Trabajo en grupos y discusión</small>
                </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card method-card" data-value="practico">
                <div class="card-body text-center">
                    <i class="fas fa-hands mb-2"></i>
                    <h6>Método Práctico</h6>
                    <small>Ejercicios y aplicación directa</small>
                </div>
                </div>
            </div>
            </div>
            <input type="hidden" id="metodosSeleccionados" name="metodos">
        </div>

<div class="form-group mt-4">
    <label class="form-label">
        <i class="fas fa-list-check"></i>
        Secuencia de actividades
    </label>
    <div class="activity-builder">
        <div class="activity-section mb-4">
            <h6><i class="fas fa-play-circle me-2"></i>Inicio</h6>
            <div class="activity-inputs">
                <div class="input-group mb-2">
                    <span class="input-group-text"><i class="fas fa-plus-circle"></i></span>
                    <input type="text" class="form-control activity-input" placeholder="Agregar actividad de inicio..." data-section="inicio">
                    <button class="btn btn-outline-primary add-activity" type="button"><i class="fas fa-plus"></i></button>
                </div>
                <div class="activities-list" id="inicio-activities">
                    <!-- Aquí se agregarán dinámicamente las actividades -->
                </div>
            </div>
        </div>

        <div class="activity-section mb-4">
            <h6><i class="fas fa-cogs me-2"></i>Desarrollo</h6>
            <div class="activity-inputs">
                <div class="input-group mb-2">
                    <span class="input-group-text"><i class="fas fa-plus-circle"></i></span>
                    <input type="text" class="form-control activity-input" placeholder="Agregar actividad de desarrollo..." data-section="desarrollo">
                    <button class="btn btn-outline-primary add-activity" type="button"><i class="fas fa-plus"></i></button>
                </div>
                <div class="activities-list" id="desarrollo-activities">
                    <!-- Aquí se agregarán dinámicamente las actividades -->
                </div>
            </div>
        </div>

        <div class="activity-section">
            <h6><i class="fas fa-flag-checkered me-2"></i>Cierre</h6>
            <div class="activity-inputs">
                <div class="input-group mb-2">
                    <span class="input-group-text"><i class="fas fa-plus-circle"></i></span>
                    <input type="text" class="form-control activity-input" placeholder="Agregar actividad de cierre..." data-section="cierre">
                    <button class="btn btn-outline-primary add-activity" type="button"><i class="fas fa-plus"></i></button>
                </div>
                <div class="activities-list" id="cierre-activities">
                    <!-- Aquí se agregarán dinámicamente las actividades -->
                </div>
            </div>
        </div>

        <!-- Campo oculto para almacenar todas las actividades -->
        <input type="hidden" id="actividadesSeleccionadas" name="actividades">
    </div>
</div>


        </div>
    </div>
    </div>

    
<!-- Código para el Paso 5: Recursos Didácticos mejorado -->
<div class="wizard-card wizard-step animated-element" id="step5">
  <h4 class="step-title">
    <i class="fas fa-toolbox me-2"></i>
    Paso 5: Recursos Didácticos
  </h4>
  
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-tools"></i>
          Materiales y Recursos
        </label>
        
        <div class="row g-4 justify-content-center">
          <div class="col-md-5">
            <div class="card resource-card" data-value="material">
              <div class="card-body text-center">
                <i class="fas fa-pencil-ruler mb-3 resource-icon"></i>
                <h6>Material Físico</h6>
                <div class="resource-options mt-3 d-none">
                  <div class="form-check">
                    <input class="form-check-input stop-propagation" type="checkbox" value="libros">
                    <label class="form-check-label">Libros de texto</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input stop-propagation" type="checkbox" value="fichas">
                    <label class="form-check-label">Fichas de trabajo</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input stop-propagation" type="checkbox" value="materiales">
                    <label class="form-check-label">Materiales manipulativos</label>
                  </div>
                  
                  <!-- Sección para añadir nuevos materiales físicos -->
                  <div class="add-resource-section mt-3">
                    <div class="input-group mb-2">
                      <input type="text" class="form-control form-control-sm new-resource-input stop-propagation" 
                             placeholder="Nuevo material físico..." data-resource-type="material">
                      <button class="btn btn-outline-secondary btn-sm add-resource-btn stop-propagation" type="button">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                    <div class="custom-resources-list" id="material-custom-resources">
                      <!-- Aquí se mostrarán los recursos personalizados añadidos -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-5">
            <div class="card resource-card" data-value="digital">
              <div class="card-body text-center">
                <i class="fas fa-laptop mb-3 resource-icon"></i>
                <h6>Recursos Digitales</h6>
                <div class="resource-options mt-3 d-none">
                  <div class="form-check">
                    <input class="form-check-input stop-propagation" type="checkbox" value="videos">
                    <label class="form-check-label">Videos educativos</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input stop-propagation" type="checkbox" value="apps">
                    <label class="form-check-label">Apps interactivas</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input stop-propagation" type="checkbox" value="presentaciones">
                    <label class="form-check-label">Presentaciones</label>
                  </div>
                  
                  <!-- Sección para añadir nuevos recursos digitales con links -->
                  <div class="add-resource-section mt-3">
                    <div class="input-group mb-2">
                      <input type="text" class="form-control form-control-sm new-resource-input stop-propagation" 
                             placeholder="Nombre del recurso..." data-resource-type="digital">
                      <button class="btn btn-outline-secondary btn-sm add-resource-btn stop-propagation" type="button">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                    <div class="input-group mb-2">
                      <input type="url" class="form-control form-control-sm stop-propagation" id="digital-resource-link" 
                             placeholder="URL del recurso (opcional)">
                      <button class="btn btn-outline-secondary btn-sm stop-propagation" id="attach-link-btn" type="button" disabled>
                        <i class="fas fa-link"></i>
                      </button>
                    </div>
                    <div class="custom-resources-list" id="digital-custom-resources">
                      <!-- Aquí se mostrarán los recursos digitales personalizados añadidos -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <input type="hidden" id="recursosSeleccionados" name="recursos">
      </div>
    </div>
  </div>
</div>

<!-- Paso 6 y Final -->
<div class="wizard-card wizard-step animated-element" id="step6">
  <h4 class="step-title">
    <i class="fas fa-chart-bar me-2"></i>
    Paso 6: Evaluación del Aprendizaje
  </h4>

  <div class="row">
    <div class="col-md-12">
      <!-- Sección de Criterios de Evaluación -->
      <div class="form-group mb-4">
        <label class="form-label">
          <i class="fas fa-tasks"></i>
          Criterios de Evaluación
        </label>
        <div class="criteria-builder">
          <div class="row g-3">
            <!-- Dimensiones de evaluación predefinidas -->
            <div class="col-md-4">
              <div class="card evaluation-card" data-dimension="conocimientos">
                <div class="card-body text-center">
                  <i class="fas fa-brain mb-2"></i>
                  <h6>Conocimientos</h6>
                  <small>Comprensión y dominio del tema</small>
                  <div class="criteria-list mt-3 d-none">
                    <div class="form-check mb-2">
                      <input class="form-check-input stop-propagation" type="checkbox" value="comprension">
                      <label class="form-check-label">Comprensión conceptual</label>
                    </div>
                    <div class="form-check mb-2">
                      <input class="form-check-input stop-propagation" type="checkbox" value="aplicacion">
                      <label class="form-check-label">Aplicación práctica</label>
                    </div>
                    <div class="add-criteria-section">
                      <div class="input-group input-group-sm">
                        <input type="text" class="form-control new-criteria stop-propagation" placeholder="Agregar criterio...">
                        <button class="btn btn-outline-primary add-criteria-btn stop-propagation" type="button">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="card evaluation-card" data-dimension="habilidades">
                <div class="card-body text-center">
                  <i class="fas fa-cogs mb-2"></i>
                  <h6>Habilidades</h6>
                  <small>Destrezas y competencias</small>
                  <div class="criteria-list mt-3 d-none">
                    <div class="form-check mb-2">
                      <input class="form-check-input stop-propagation" type="checkbox" value="resolucion">
                      <label class="form-check-label">Resolución de problemas</label>
                    </div>
                    <div class="form-check mb-2">
                      <input class="form-check-input stop-propagation" type="checkbox" value="comunicacion">
                      <label class="form-check-label">Comunicación efectiva</label>
                    </div>
                    <div class="add-criteria-section">
                      <div class="input-group input-group-sm">
                        <input type="text" class="form-control new-criteria stop-propagation" placeholder="Agregar criterio...">
                        <button class="btn btn-outline-primary add-criteria-btn stop-propagation" type="button">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-4">
              <div class="card evaluation-card" data-dimension="actitudes">
                <div class="card-body text-center">
                  <i class="fas fa-heart mb-2"></i>
                  <h6>Actitudes</h6>
                  <small>Comportamiento y valores</small>
                  <div class="criteria-list mt-3 d-none">
                    <div class="form-check mb-2">
                      <input class="form-check-input stop-propagation" type="checkbox" value="participacion">
                      <label class="form-check-label">Participación activa</label>
                    </div>
                    <div class="form-check mb-2">
                      <input class="form-check-input stop-propagation" type="checkbox" value="colaboracion">
                      <label class="form-check-label">Trabajo colaborativo</label>
                    </div>
                    <div class="add-criteria-section">
                      <div class="input-group input-group-sm">
                        <input type="text" class="form-control new-criteria stop-propagation" placeholder="Agregar criterio...">
                        <button class="btn btn-outline-primary add-criteria-btn stop-propagation" type="button">
                          <i class="fas fa-plus"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección de Instrumentos de Evaluación -->
      <div class="form-group">
        <label class="form-label">
          <i class="fas fa-clipboard-check"></i>
          Instrumentos de Evaluación
        </label>
        <div class="row g-3">
          <div class="col-md-6">
            <div class="card instrument-card" data-type="formativo">
              <div class="card-body">
                <h6><i class="fas fa-sync-alt me-2"></i>Evaluación Formativa</h6>
                <div class="instruments-list">
                  <div class="instrument-option mb-2">
                    <div class="form-check">
                      <input class="form-check-input stop-propagation" type="checkbox" value="observacion">
                      <label class="form-check-label">Registro de observación</label>
                    </div>
                  </div>
                  <div class="instrument-option mb-2">
                    <div class="form-check">
                      <input class="form-check-input stop-propagation" type="checkbox" value="rubricas">
                      <label class="form-check-label">Rúbricas de desempeño</label>
                    </div>
                  </div>
                  <div class="instrument-option mb-2">
                    <div class="form-check">
                      <input class="form-check-input stop-propagation" type="checkbox" value="portfolio">
                      <label class="form-check-label">Portafolio de evidencias</label>
                    </div>
                  </div>
                  <!-- Sección para añadir instrumentos formativos personalizados -->
                  <div class="add-instrument-section mt-3">
                    <div class="input-group input-group-sm mb-2">
                      <input type="text" class="form-control new-instrument stop-propagation" data-type="formativo" placeholder="Agregar instrumento...">
                      <button class="btn btn-outline-primary add-instrument-btn stop-propagation" type="button">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="card instrument-card" data-type="sumativo">
              <div class="card-body">
                <h6><i class="fas fa-check-double me-2"></i>Evaluación Sumativa</h6>
                <div class="instruments-list">
                  <div class="instrument-option mb-2">
                    <div class="form-check">
                      <input class="form-check-input stop-propagation" type="checkbox" value="examenes">
                      <label class="form-check-label">Exámenes escritos</label>
                    </div>
                  </div>
                  <div class="instrument-option mb-2">
                    <div class="form-check">
                      <input class="form-check-input stop-propagation" type="checkbox" value="proyectos">
                      <label class="form-check-label">Proyectos finales</label>
                    </div>
                  </div>
                  <div class="instrument-option mb-2">
                    <div class="form-check">
                      <input class="form-check-input stop-propagation" type="checkbox" value="presentaciones">
                      <label class="form-check-label">Presentaciones orales</label>
                    </div>
                  </div>
                  <!-- Sección para añadir instrumentos sumativos personalizados -->
                  <div class="add-instrument-section mt-3">
                    <div class="input-group input-group-sm mb-2">
                      <input type="text" class="form-control new-instrument stop-propagation" data-type="sumativo" placeholder="Agregar instrumento...">
                      <button class="btn btn-outline-primary add-instrument-btn stop-propagation" type="button">
                        <i class="fas fa-plus"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Campo oculto para almacenar los datos de evaluación -->
      <input type="hidden" id="evaluacionSeleccionada" name="evaluacion">
    </div>
  </div>
</div>

<!-- Cierre de Wizard Body Abajo-->

    </div>
      <div class="wizard-footer d-flex justify-content-center">
        <i class="fas fa-arrow-down arrow-nav arrow-down mt-5" id="btn-next"></i>
      </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/l10n/es.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.13.2/jquery-ui.min.js"></script>
  
  <script>
    $(document).ready(function() {
      // Inicializar datepicker para fechas
      flatpickr("#fechas", {
        mode: "range",
        dateFormat: "d/m/Y",
        locale: "es",
        minDate: "today",
        altInput: true,
        altFormat: "j \\de F \\de Y",
        conjunction: " al ",
        onChange: function(selectedDates, dateStr) {
          if (selectedDates.length === 2) {
            $("#fechas").parent().addClass("field-complete");
          } else {
            $("#fechas").parent().removeClass("field-complete");
          }
        }
      });
      
      // Gestionar la selección de asignatura
      $("#areaAsignatura").change(function() {
  if ($(this).val() === "otra") {
    $("#areaAsignaturaOtra").removeClass("d-none");
  } else {
    $("#areaAsignaturaOtra").addClass("d-none");
  }

  $(this).closest(".form-group").addClass("field-complete");
});
      
      // Gestionar las sesiones
      $("#cantidadSesiones, #duracionSesiones").on("input", function() {
        const cantidad = $("#cantidadSesiones").val();
        const duracion = $("#duracionSesiones").val();
        
        if (cantidad && duracion) {
          $("#sesionesInput").val(`${cantidad} sesiones de ${duracion} minutos`);
          $(this).parents(".form-group").addClass("field-complete");
        }
      });
      
      // Gestionar las etiquetas
      $("#tagInput").keydown(function(e) {
        if (e.keyCode === 13 && $(this).val().trim() !== "") {
          e.preventDefault();
          const tagText = $(this).val().trim();
          
          const tag = $(`
            <div class="tag">
              ${tagText}
              <span class="tag-close">&times;</span>
            </div>
          `);
          
          $(this).before(tag);
          $(this).val("");
          
          // Actualizar el campo oculto con todas las etiquetas
          updateTags();
        }
      });
      
      // Eliminar etiqueta al hacer clic en la x
      $(document).on("click", ".tag-close", function() {
        $(this).parent().remove();
        updateTags();
      });
      
      function updateTags() {
        const tags = [];
        $(".tag").each(function() {
          tags.push($(this).text().trim().replace("×", ""));
        });
      }
      
// Gestionar selección de nivel
// Definir opciones por nivel
const nivelesDetalle = {
  preescolar: {
    grados: ["Preescolar 1", "Preescolar 2", "Preescolar 3", "Preescolar 4", "Preescolar 5", "Preescolar 6"],
    secciones: ["A", "B", "C"]
  },
  primaria: {
    grados: ["1º Primaria", "2º Primaria", "3º Primaria", "4º Primaria", "5º Primaria", "6º Primaria"],
    secciones: ["A", "B", "C", "D"]
  },
  secundaria: {
    grados: ["1º Secundaria", "2º Secundaria", "3º Secundaria", "4º Secundaria", "5º Secundaria", "6º Secundaria"],
    tecnicos: ["Informática", "Contabilidad", "Electricidad", "Electrónica", "Mecánica"]
  }
};

$(".nivel-card").click(function() {
  // Remover selección previa
  $(".nivel-card").removeClass("selected");
  
  // Seleccionar nueva tarjeta
  $(this).addClass("selected");
  
  // Obtener y establecer el valor
  const nivel = $(this).data("value");
  $("#gradoInput").val(nivel);
  
  // Mostrar contenedores
  $("#nivelDetalle").removeClass("d-none");
  $("#seccionesTecnicos").removeClass("d-none");
  
  // Cargar grados
  const opciones = nivelesDetalle[nivel].grados.map(opcion => 
    `<option value="${opcion}">${opcion}</option>`
  ).join('');
  
  $("#gradoDetalle").html(opciones);
  
  // Cargar secciones o técnicos
  const container = $(".secciones-container");
  container.empty();
  
  const items = nivel === 'secundaria' ? 
    nivelesDetalle[nivel].tecnicos : 
    nivelesDetalle[nivel].secciones;
  
items.forEach(item => {
  container.append(`
    <div class="seccion-check">
      <label class="form-check-label" for="${item}">${item}</label>
    </div>
  `);
});

// Permitir seleccionar/deseleccionar secciones/técnicos
$(".seccion-check").click(function () {
  $(this).toggleClass("selected");
});

});

// Actualizar valor cuando se seleccionan secciones/técnicos
$(document).on('change', '.secciones-container input', function() {
  const seleccionados = [];
  $('.secciones-container input:checked').each(function() {
    seleccionados.push($(this).val());
  });
  // Puedes guardar los seleccionados en un campo oculto si lo necesitas
  console.log("Secciones/Técnicos seleccionados:", seleccionados);
});



// filepath: c:\Users\pc personal\Desktop\Pasantia\Dashboards\form2.html
function actualizarTemasSeleccionados() {
  const temasSeleccionados = [];
  $(".multi-select-item.selected").each(function() {
    temasSeleccionados.push({
      valor: $(this).data("value"),
      texto: $(this).text()
    });
  });
  
  $("#temasSeleccionados").val(JSON.stringify(temasSeleccionados));
  
  // Actualizar lista ordenable
  $("#sortableList").empty();
  temasSeleccionados.forEach(tema => {
    $("#sortableList").append(`
      <div class="list-group-item" data-value="${tema.valor}">
        <i class="fas fa-grip-vertical me-2"></i>
        ${tema.texto}
      </div>
    `);
  });

  // Inicializar sortable
  $("#sortableList").sortable({
    handle: '.fa-grip-vertical',
    update: function(event, ui) {
      // Actualizar el orden cuando se mueven los elementos
      const nuevoOrden = [];
      $(this).find('.list-group-item').each(function() {
        nuevoOrden.push($(this).data('value'));
      });
      // Aquí puedes guardar el nuevo orden si lo necesitas
      console.log('Nuevo orden:', nuevoOrden);
    }
  });
}
      // Gestionar distribución temporal
      $("#distribucionTiempo").change(function() {
        if ($(this).val() === "personalizada") {
          $("#tiempoPersonalizado").removeClass("d-none");
          const temasSeleccionados = JSON.parse($("#temasSeleccionados").val() || "[]");
          mostrarAjusteTiempo(temasSeleccionados);
        } else {
          $("#tiempoPersonalizado").addClass("d-none");
        }
      });

      function mostrarAjusteTiempo(temas) {
        $("#tiempoPersonalizado").html(
          temas.map(tema => `
            <div class="input-group mb-2">
              <span class="input-group-text">${tema.texto}</span>
              <input type="number" class="form-control" min="1" value="1" data-tema="${tema.valor}">
              <span class="input-group-text">sesión(es)</span>
            </div>
          `).join("")
        );
      }

// Gestionar selección múltiple de temas del paso 3
$("#temasSelected").click(function() {
  $("#temasDropdown").slideToggle();
});

$(".multi-select-item").click(function() {
  $(this).toggleClass("selected");
  
  // Actualizar el texto del selector
  const temasSeleccionados = $(".multi-select-item.selected").map(function() {
    return $(this).text();
  }).get();
  
  if (temasSeleccionados.length > 0) {
    $("#temasSelected").html(
      temasSeleccionados.join(", ") + 
      '<i class="fas fa-chevron-down"></i>'
    );
  } else {
    $("#temasSelected").html(
      'Seleccione los temas principales' +
      '<i class="fas fa-chevron-down"></i>'
    );
  }
  
  actualizarTemasSeleccionados();
});

//Paso 4 logica
// Gestionar selección de métodos de enseñanza
$(".method-card").click(function (e) {
  //Ignorar el click si proviene del textarea
  if ($(e.target).is("textarea")) return;

  const $card = $(this);
  const valor = $card.data("value");
  const titulo = $card.find("h6").text();

  $card.toggleClass("selected");

  // Agregar o remover textarea de detalles
  if ($card.hasClass("selected")) {
    if ($card.find(".method-textarea").length === 0) {
      $card.find(".card-body").append(`
        <div class="method-details mt-2">
          <textarea class="form-control method-textarea" placeholder="Agregue detalles sobre este método..."></textarea>
        </div>
      `);
    }
  } else {
    $card.find(".method-details").remove();
  }

  // Actualizar el campo oculto con los métodos seleccionados
  const metodosSeleccionados = $(".method-card.selected").map(function () {
    return {
      valor: $(this).data("value"),
      texto: $(this).find("h6").text(),
      detalles: $(this).find(".method-textarea").val() || ""
    };
  }).get();

  $("#metodosSeleccionados").val(JSON.stringify(metodosSeleccionados));

  if (metodosSeleccionados.length > 0) {
    $card.closest(".form-group").addClass("field-complete");
  } else {
    $card.closest(".form-group").removeClass("field-complete");
  }
});



// Función para actualizar el campo oculto con todas las actividades
function actualizarActividades() {
  const actividades = {
    inicio: [],
    desarrollo: [],
    cierre: []
  };
  
  // Recopilar actividades de inicio
  $("#inicio-activities .activity-item").each(function() {
    actividades.inicio.push($(this).text().replace("×", "").trim());
  });
  
  // Recopilar actividades de desarrollo
  $("#desarrollo-activities .activity-item").each(function() {
    actividades.desarrollo.push($(this).text().replace("×", "").trim());
  });
  
  // Recopilar actividades de cierre
  $("#cierre-activities .activity-item").each(function() {
    actividades.cierre.push($(this).text().replace("×", "").trim());
  });
  
  // Actualizar el campo oculto
  $("#actividadesSeleccionadas").val(JSON.stringify(actividades));
}

// Añadir actividad al hacer clic en el botón o presionar Enter
$(".add-activity").click(function() {
  const input = $(this).closest(".input-group").find(".activity-input");
  addActivity(input);
});

$(".activity-input").keypress(function(e) {
  if (e.which === 13) { // Enter key
    e.preventDefault();
    addActivity($(this));
  }
});

function addActivity(input) {
  const activityText = input.val().trim();
  const section = input.data("section");
  
  if (activityText) {
    // Crear elemento de actividad
    const activityItem = $(`
      <div class="activity-item alert alert-light d-flex justify-content-between align-items-center">
        ${activityText}
        <button type="button" class="btn-close delete-activity" aria-label="Close"></button>
      </div>
    `);
    
    // Añadir al contenedor correspondiente
    $(`#${section}-activities`).append(activityItem);
    
    // Limpiar el campo de entrada
    input.val("");
    
    // Actualizar el campo oculto
    actualizarActividades();
  }
}

// Eliminar actividad
$(document).on("click", ".delete-activity", function() {
  $(this).closest(".activity-item").remove();
  actualizarActividades();
});

// Cerrar el dropdown cuando se hace clic fuera
$(document).click(function(e) {
  if (!$(e.target).closest('.multi-select-container').length) {
    $("#temasDropdown").slideUp();
  }
});


// Gestionar selección de actividades
$(".activity-option").click(function() {
  $(this).toggleClass("selected");
});

// Paso 5
// JavaScript para manejar los recursos didácticos

// Selección de tarjetas de recursos
$(".resource-card").click(function(e) {
  // Evitar que se propague el evento si el clic fue en elementos específicos
  if ($(e.target).hasClass('stop-propagation') || $(e.target).closest('.stop-propagation').length) {
    return;
  }

  $(this).toggleClass("selected");
  
  // Mostrar/ocultar opciones al seleccionar/deseleccionar tarjetas
  if ($(this).hasClass("selected")) {
    $(this).find(".resource-options").removeClass("d-none").hide().slideDown(300);
  } else {
    $(this).find(".resource-options").slideUp(300, function() {
      $(this).addClass("d-none");
    });
  }
  
  actualizarRecursosSeleccionados();
});

// Detener la propagación en elementos específicos
$(document).on('click', '.stop-propagation', function(e) {
  e.stopPropagation();
});

// Actualizar el campo oculto con los recursos seleccionados
function actualizarRecursosSeleccionados() {
  const recursos = {
    material: {
      predefinidos: [],
      personalizados: []
    },
    digital: {
      predefinidos: [],
      personalizados: []
    }
  };
  
  // Recoger recursos físicos predefinidos seleccionados
  if ($(".resource-card[data-value='material']").hasClass("selected")) {
    $(".resource-card[data-value='material'] .form-check-input:checked").each(function() {
      recursos.material.predefinidos.push($(this).val());
    });
  }
  
  // Recoger recursos digitales predefinidos seleccionados
  if ($(".resource-card[data-value='digital']").hasClass("selected")) {
    $(".resource-card[data-value='digital'] .form-check-input:checked").each(function() {
      recursos.digital.predefinidos.push($(this).val());
    });
  }
  
  // Recoger recursos personalizados
  $("#material-custom-resources .custom-resource-item").each(function() {
    recursos.material.personalizados.push({
      nombre: $(this).data("resource-name")
    });
  });
  
  $("#digital-custom-resources .custom-resource-item").each(function() {
    recursos.digital.personalizados.push({
      nombre: $(this).data("resource-name"),
      link: $(this).data("resource-link") || ""
    });
  });
  
  // Actualizar el campo oculto
  $("#recursosSeleccionados").val(JSON.stringify(recursos));
}

// Variables para manejar la adición de recursos digitales
let currentDigitalResource = "";
let currentDigitalLink = "";

// Activar/desactivar botón de enlace
$("#digital-resource-link").on("input", function() {
  const link = $(this).val().trim();
  $("#attach-link-btn").prop("disabled", !link);
  currentDigitalLink = link;
});

// Añadir nuevos recursos
$(".add-resource-btn").click(function(e) {
  e.stopPropagation(); // Detener la propagación para evitar que se deseleccione la tarjeta
  
  const inputElement = $(this).closest(".input-group").find(".new-resource-input");
  const resourceType = inputElement.data("resource-type");
  const resourceName = inputElement.val().trim();
  
  if (resourceName) {
    if (resourceType === "material") {
      // Añadir recurso físico
      agregarRecursoPersonalizado(resourceName, resourceType);
      inputElement.val("");
    } else if (resourceType === "digital") {
      // Guardar nombre del recurso digital para posible adjunto de link
      currentDigitalResource = resourceName;
      inputElement.val("");
      
      // Si hay un link ya ingresado, adjuntarlo automáticamente
      if ($("#digital-resource-link").val().trim()) {
        $("#attach-link-btn").click();
      } else {
        // Si no hay link, añadir solo el nombre
        agregarRecursoPersonalizado(resourceName, resourceType);
        $("#digital-resource-link").focus();
      }
    }
  }
});

// Adjuntar link a un recurso digital
$("#attach-link-btn").click(function(e) {
  e.stopPropagation(); // Detener la propagación
  
  const resourceName = currentDigitalResource;
  const resourceLink = $("#digital-resource-link").val().trim();
  
  if (resourceName && resourceLink) {
    agregarRecursoPersonalizado(resourceName, "digital", resourceLink);
    
    // Limpiar campos
    $("#digital-resource-link").val("");
    $("#attach-link-btn").prop("disabled", true);
    currentDigitalResource = "";
    currentDigitalLink = "";
  }
});

// También permitir añadir presionando Enter
$(".new-resource-input").keypress(function(e) {
  if (e.which === 13) { // Enter key
    e.preventDefault();
    e.stopPropagation();
    $(this).closest(".input-group").find(".add-resource-btn").click();
  }
});

$("#digital-resource-link").keypress(function(e) {
  if (e.which === 13) { // Enter key
    e.preventDefault();
    e.stopPropagation();
    if (!$("#attach-link-btn").prop("disabled")) {
      $("#attach-link-btn").click();
    }
  }
});

// Función para agregar un recurso personalizado
function agregarRecursoPersonalizado(nombre, tipo, link = "") {
  const contenedor = tipo === "material" ? "#material-custom-resources" : "#digital-custom-resources";
  const conEnlace = link ? "with-link" : "";
  
  let enlaceHTML = "";
  if (link) {
    enlaceHTML = `<a href="${link}" class="resource-link stop-propagation" target="_blank" title="${link}">
                    <i class="fas fa-external-link-alt"></i>
                  </a>`;
  }
  
  const recursoHTML = `
    <div class="custom-resource-item ${conEnlace}" data-resource-name="${nombre}" data-resource-link="${link || ''}">
      <div>
        <i class="fas fa-${tipo === 'material' ? 'cube' : 'globe'}"></i>
        <span>${nombre}</span>
        ${enlaceHTML}
      </div>
      <i class="fas fa-times delete-resource stop-propagation"></i>
    </div>
  `;
  
  $(contenedor).append(recursoHTML);
  
  // Seleccionar la tarjeta correspondiente si no está seleccionada
  const $card = $(`.resource-card[data-value='${tipo}']`);
  if (!$card.hasClass("selected")) {
    $card.addClass("selected");
    $card.find(".resource-options").removeClass("d-none").hide().slideDown(300);
  }
  
  // Actualizar el campo oculto
  actualizarRecursosSeleccionados();
}

// Eliminar un recurso personalizado
$(document).on("click", ".delete-resource", function(e) {
  e.stopPropagation(); // Detener la propagación
  $(this).closest(".custom-resource-item").remove();
  actualizarRecursosSeleccionados();
});

// Inicializar - asegurarse de que todas las tarjetas estén cerradas
$(document).ready(function() {
  // Asegurarse de que las opciones estén ocultas al principio
  $(".resource-options").addClass("d-none");
  
  // Eliminar cualquier clase 'selected' que pudiera estar presente
  $(".resource-card").removeClass("selected");
  
  // Inicializar el campo oculto
  actualizarRecursosSeleccionados();
});

// Paso 6 Logica
// Gestionar evaluaciones
$(".evaluation-card").click(function(e) {
  // Detener la propagación si el clic fue en elementos específicos
  if ($(e.target).hasClass('stop-propagation') || $(e.target).closest('.stop-propagation').length) {
    return;
  }
  
  $(this).toggleClass("selected");
  const criteriaList = $(this).find(".criteria-list");
  
  if ($(this).hasClass("selected")) {
    criteriaList.removeClass("d-none").hide().slideDown(300);
  } else {
    criteriaList.slideUp(300, function() {
      $(this).addClass("d-none");
    });
  }
  
  actualizarEvaluacion();
});

// Detener propagación en elementos interactivos
$(document).on('click', '.stop-propagation', function(e) {
  e.stopPropagation();
});

// Añadir nuevos criterios
$(".add-criteria-btn").click(function(e) {
  e.stopPropagation();
  
  const input = $(this).closest(".input-group").find(".new-criteria");
  const criterio = input.val().trim();
  
  if (criterio) {
    const criterioValue = criterio.toLowerCase().replace(/\s+/g, '-');
    const checkboxItem = `
      <div class="form-check mb-2 custom-criteria-item">
        <div>
          <input class="form-check-input stop-propagation" type="checkbox" value="${criterioValue}" checked>
          <label class="form-check-label">${criterio}</label>
        </div>
        <i class="fas fa-times delete-item stop-propagation"></i>
      </div>
    `;
    
    $(this).closest(".criteria-list").find(".add-criteria-section").before(checkboxItem);
    input.val("");
    actualizarEvaluacion();
  }
});

// Añadir nuevos instrumentos
$(".add-instrument-btn").click(function(e) {
  e.stopPropagation();
  
  const input = $(this).closest(".input-group").find(".new-instrument");
  const instrumento = input.val().trim();
  const tipo = input.data("type");
  
  if (instrumento) {
    const instrumentoValue = instrumento.toLowerCase().replace(/\s+/g, '-');
    const checkboxItem = `
      <div class="instrument-option mb-2 custom-instrument-item">
        <div class="form-check">
          <input class="form-check-input stop-propagation" type="checkbox" value="${instrumentoValue}" checked>
          <label class="form-check-label">${instrumento}</label>
        </div>
        <i class="fas fa-times delete-item stop-propagation"></i>
      </div>
    `;
    
    $(this).closest(".instruments-list").find(".add-instrument-section").before(checkboxItem);
    input.val("");
    actualizarEvaluacion();
  }
});

// Eliminar criterios o instrumentos personalizados
$(document).on("click", ".delete-item", function(e) {
  e.stopPropagation();
  $(this).closest(".form-check").closest('div').remove();
  actualizarEvaluacion();
});

// También permitir añadir presionando Enter
$(".new-criteria").keypress(function(e) {
  if (e.which === 13) { // Enter key
    e.preventDefault();
    e.stopPropagation();
    $(this).closest(".input-group").find(".add-criteria-btn").click();
  }
});

$(".new-instrument").keypress(function(e) {
  if (e.which === 13) { // Enter key
    e.preventDefault();
    e.stopPropagation();
    $(this).closest(".input-group").find(".add-instrument-btn").click();
  }
});

// Actualizar campo oculto con la evaluación
function actualizarEvaluacion() {
  const evaluacion = {
    criterios: {
      conocimientos: [],
      habilidades: [],
      actitudes: []
    },
    instrumentos: {
      formativos: [],
      sumativos: []
    }
  };
  
  // Recoger criterios seleccionados
  $(".evaluation-card").each(function() {
    const dimension = $(this).data("dimension");
    
    $(this).find("input:checked").each(function() {
      evaluacion.criterios[dimension].push({
        valor: $(this).val(),
        texto: $(this).next().text()
      });
    });
  });
  
  // Recoger instrumentos seleccionados
  $(".instrument-card[data-type='formativo'] input:checked").each(function() {
    evaluacion.instrumentos.formativos.push({
      valor: $(this).val(),
      texto: $(this).next().text()
    });
  });
  
  $(".instrument-card[data-type='sumativo'] input:checked").each(function() {
    evaluacion.instrumentos.sumativos.push({
      valor: $(this).val(),
      texto: $(this).next().text()
    });
  });
  
  // Actualizar campo oculto
  $("#evaluacionSeleccionada").val(JSON.stringify(evaluacion));
}

// Inicializar
$(document).ready(function() {
  // Mantener las tarjetas de evaluación cerradas al inicio
  $(".criteria-list").addClass("d-none");
  $(".evaluation-card").removeClass("selected");
  
  // Inicializar el campo oculto
  actualizarEvaluacion();
  
  // Asegurarse de que todos los elementos interactivos tengan la clase stop-propagation
  $(".form-check-input, .form-control, .btn").addClass("stop-propagation");
});


      // Variables para control de pasos
      let currentStep = 1;
      const totalSteps = 6;

// Función para validar el paso actual
function validateCurrentStep() {
  if (currentStep === 1) {
    const nombre = $("#nombrePlanificacion").val().trim();
    const tipo = $("#tipoPlanificacion").val();
    const grado = $("#gradoInput").val();
    const fechas = $("#fechas").val();
    
    // Validar caso especial para "otro tipo"
    if (tipo === "otro") {
      const otroTipo = $("#tipoPlanificacionOtro input").val().trim();
      if (!otroTipo) return false;
    }
    
    return nombre && tipo && grado && fechas;
  }
  
  if (currentStep === 2) {
    const aprendizaje = $("#aprendizaje").val().trim();
    return aprendizaje.length > 0;
  }

  if (currentStep === 3) {
    const temasSeleccionados = $(".multi-select-item.selected").length;
    return temasSeleccionados > 0;
  }

  if (currentStep === 4) {
    const metodosSeleccionados = $(".method-card.selected").length;
    const actividadesInicio = $("#inicio-activities .activity-item").length;
    const actividadesDesarrollo = $("#desarrollo-activities .activity-item").length;
    const actividadesCierre = $("#cierre-activities .activity-item").length;
    
    return metodosSeleccionados > 0 && 
    (actividadesInicio > 0 || actividadesDesarrollo > 0 || actividadesCierre > 0);
  }

    if (currentStep === 5) {
    const recursosSeleccionados = $(".resource-card.selected").length;
    return recursosSeleccionados > 0;
  }

  if (currentStep === 6) {
  const criteriosSeleccionados = Object.values(JSON.parse($("#evaluacionSeleccionada").val()).criterios)
    .reduce((total, criterios) => total + criterios.length, 0);
  
  const instrumentosSeleccionados = 
    JSON.parse($("#evaluacionSeleccionada").val()).instrumentos.formativos.length + 
    JSON.parse($("#evaluacionSeleccionada").val()).instrumentos.sumativos.length;
  
  return criteriosSeleccionados > 0 && instrumentosSeleccionados > 0;
  }

  return false;
}

// Función para actualizar la barra de progreso
function updateProgress() {
  const progress = (currentStep / totalSteps) * 100;
  $(".wizard-progress-bar").css("width", `${progress}%`);
}

// Función para cambiar de paso
function goToStep(step) {
  // Ocultar todos los pasos
  $(".wizard-step").removeClass("active").addClass("d-none");
  
  // Mostrar el paso actual
  $(`#step${step}`).addClass("active").removeClass("d-none");
  
  // Actualizar flechas
  if (step === 1) {
    $("#btn-prev").addClass("disabled");
  } else {
    $("#btn-prev").removeClass("disabled");
  }
  
  if (step === totalSteps) {
    $("#btn-next").removeClass("fa-arrow-down").addClass("fa-check");
  } else {
    $("#btn-next").addClass("fa-arrow-down").removeClass("fa-check");
  }
  
  currentStep = step;
  updateProgress();
}

// TAMBIÉN ASEGÚRATE DE QUE EL HTML DE TODOS LOS PASOS NO TENGA d-none
// EXCEPTO EL PASO 1 QUE DEBE TENER LA CLASE "active"

// Inicialización correcta:
$(document).ready(function() {
  // Asegurar que solo el paso 1 esté visible al inicio
  $(".wizard-step").removeClass("active").addClass("d-none");
  $("#step1").addClass("active").removeClass("d-none");
  
  // Resto de tu código de inicialización...
});

// Manejar clic en flecha siguiente
$("#btn-next").click(function() {
  if ($(this).hasClass("disabled")) return;
  
  if (true) {
    if (currentStep < totalSteps) {
      goToStep(currentStep + 1);
    } else {
      // Aquí iría la lógica para finalizar el formulario
      alert("¡Formulario completado!");
    }
  } else {
    alert("Por favor complete todos los campos requeridos antes de continuar.");
  }
});

// Manejar clic en flecha anterior
$("#btn-prev").click(function() {
  if ($(this).hasClass("disabled")) return;
  
  if (currentStep > 1) {
    goToStep(currentStep - 1);
  }
});

// Inicializar primer paso
goToStep(1);

    });

    
// Variables para el manejo de áreas
let areaSeleccionada = null;

// Inicializar el manejo de áreas
$(document).ready(function() {
  // Click en las tarjetas de área
  $(".subject-card").click(function() {
    // Remover selección previa
    $(".subject-card").removeClass("selected");
    
    // Seleccionar nueva tarjeta
    $(this).addClass("selected");
    
    // Obtener valor
    areaSeleccionada = $(this).data("value");
    $("#areaSeleccionada").val(areaSeleccionada);
    
    // Cargar competencias para el área seleccionada
    cargarCompetencias(areaSeleccionada);
    
    // Marcar sección como completa
    marcarSeccionCompleta("area-section");
    
    // Cargar contenidos automáticos
    setTimeout(cargarContenidosAutomaticos, 300);
  });
});


// Cargar competencias según el área
function cargarCompetencias(area) {
    const competencias = competenciasPorArea[area] || [];
    const select = $("#competenciasDisponibles");

    select.empty();

    if (competencias.length === 0) {
        select.append(`<option disabled>No hay competencias disponibles para esta área</option>`);
        return;
    }

    competencias.forEach((comp, index) => {
        select.append(`<option value="${area}_${index}">${comp}</option>`);
    });

    actualizarIndicadores();
}

// Agregar competencias seleccionadas
$("#agregarCompetencia").click(function() {
    const selected = $("#competenciasDisponibles option:selected");
    
    selected.each(function() {
        const value = $(this).val();
        const text = $(this).text();
        
        // Verificar si ya está agregada
        if (!$(`#competenciasElegidas [data-value="${value}"]`).length) {
            const competenciaItem = $(`
                <span class="competencia-item" data-value="${value}">
                    ${text}
                    <span class="remove-competencia">&times;</span>
                </span>
            `);
            
            $("#competenciasElegidas").append(competenciaItem);
        }
    });
    
    actualizarCompetenciasSeleccionadas();
    actualizarIndicadores();
});

// Remover competencia
$(document).on("click", ".remove-competencia", function() {
    $(this).parent().remove();
    actualizarCompetenciasSeleccionadas();
    actualizarIndicadores();
});

// Actualizar campo oculto de competencias
function actualizarCompetenciasSeleccionadas() {
    const competencias = [];
    $(".competencia-item").each(function() {
        competencias.push({
            value: $(this).data("value"),
            text: $(this).text().replace("×", "").trim()
        });
    });
    $("#competenciasSeleccionadas").val(JSON.stringify(competencias));
}

// Función para agregar contenidos
function agregarContenido(tipo) {
    const input = $(`#input${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
    const contenido = input.val().trim();
    
    if (contenido) {
        const lista = $(`#lista${tipo.charAt(0).toUpperCase() + tipo.slice(1)}es`);
        
        const contenidoItem = $(`
            <div class="contenido-item" data-tipo="${tipo}">
                <span>${contenido}</span>
                <i class="fas fa-times delete-contenido"></i>
            </div>
        `);
        
        lista.append(contenidoItem);
        input.val("");
        
        actualizarContenidosSeleccionados();
    }
}

// También permitir agregar con Enter
$("[id^='input']").keypress(function(e) {
    if (e.which === 13) {
        e.preventDefault();
        const tipo = $(this).attr('id').replace('input', '').toLowerCase();
        agregarContenido(tipo);
    }
});

// Eliminar contenido
$(document).on("click", ".delete-contenido", function() {
    $(this).parent().remove();
    actualizarContenidosSeleccionados();
});

// Actualizar campo oculto de contenidos
function actualizarContenidosSeleccionados() {
    const contenidos = {
        conceptuales: [],
        procedimentales: [],
        actitudinales: []
    };
    
    $(".contenido-item").each(function() {
        const tipo = $(this).data("tipo");
        const texto = $(this).find("span").text();
        contenidos[tipo + "es"].push(texto);
    });
    
    $("#contenidosSeleccionados").val(JSON.stringify(contenidos));
}

// Nueva función para limpiar formulario y recursos
function limpiarFormularioActividad() {
  // Limpiar campos del formulario
  $("#actTitle, #actDuration, #actType, #actMethod, #actDescription").val('');
  $("#actDuration").val('0');
  
  // Limpiar recursos agregados
  $("#recursosAgregados").html(`
    <div class="empty-resources-state text-center p-4">
      <i class="fas fa-folder-open fa-3x text-muted mb-3 opacity-50"></i>
      <p class="text-muted">No hay recursos digitales agregados.</p>
    </div>
  `);
  
  // Resetear contador
  $("#totalRecursos").text('0');
}
// Actualizar indicadores según competencias seleccionadas
function actualizarIndicadores() {
    const indicadoresContainer = $("#indicadoresDisponibles");
    indicadoresContainer.empty();
    
    // Ejemplo de indicadores (en producción vendría de una BD)
    const indicadoresEjemplo = [
        "Identifica conceptos clave de manera precisa",
        "Aplica procedimientos de forma sistemática",
        "Demuestra comprensión profunda del tema",
        "Relaciona conceptos con situaciones reales"
    ];
    
    indicadoresEjemplo.forEach((indicador, index) => {
        indicadoresContainer.append(`
            <div class="indicador-item">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input indicador-check" 
                           value="ind_${index}" data-texto="${indicador}">
                    ${indicador}
                </label>
            </div>
        `);
    });
}

// Agregar indicador personalizado
$("#btnAgregarIndicador").click(function() {
    const indicador = $("#nuevoIndicador").val().trim();
    
    if (indicador) {
        const timestamp = Date.now();
        $("#indicadoresDisponibles").append(`
            <div class="indicador-item indicador-personalizado">
                <label class="form-check-label">
                    <input type="checkbox" class="form-check-input indicador-check" 
                           value="custom_${timestamp}" data-texto="${indicador}" checked>
                    ${indicador}
                    <i class="fas fa-user-edit ms-2" title="Indicador personalizado"></i>
                </label>
            </div>
        `);
        
        $("#nuevoIndicador").val("");
        actualizarIndicadoresSeleccionados();
    }
});

// También permitir agregar con Enter
$("#nuevoIndicador").keypress(function(e) {
    if (e.which === 13) {
        e.preventDefault();
        $("#btnAgregarIndicador").click();
    }
});

// Actualizar indicadores seleccionados
$(document).on("change", ".indicador-check", function() {
    actualizarIndicadoresSeleccionados();
});

function actualizarIndicadoresSeleccionados() {
    const indicadores = [];
    $(".indicador-check:checked").each(function() {
        indicadores.push({
            value: $(this).val(),
            text: $(this).data("texto")
        });
    });
    $("#indicadoresSeleccionados").val(JSON.stringify(indicadores));
}

// Modificar la función de validación para incluir el paso 2
function validateCurrentStep() {
    if (currentStep === 1) {
        const nombre = $("#nombrePlanificacion").val().trim();
        const tipo = $("#tipoPlanificacion").val();
        const grado = $("#gradoInput").val();
        const fechas = $("#fechas").val();
        
        if (tipo === "otro") {
            const otroTipo = $("#tipoPlanificacionOtro input").val().trim();
            if (!otroTipo) return false;
        }
        
        return nombre && tipo && grado && fechas;
    }
    
    if (currentStep === 2) {
        const area = $("#areaAsignatura").val();
        const competencias = $(".competencia-item").length;
        const contenidos = $(".contenido-item").length;
        const indicadores = $(".indicador-check:checked").length;
        
        if (area === "otra") {
            const otraArea = $("#areaAsignaturaOtra input").val().trim();
            if (!otraArea) return false;
        }
        
        return area && competencias > 0 && contenidos > 0 && indicadores > 0;
    }
    
}
// JAVASCRIPT LIMPIO PARA STEP 3
$(document).ready(function() {
  let activities = [];
  let editIndex = -1;

  // Abrir modal
  $("#addActivityBtn").click(function() {
    editIndex = -1;
    clearForm();
    $("#activityModal").modal('show');
  });

  function clearForm() {
    $("#actTitle, #actDuration, #actType, #actMethod, #actDescription, #actResources").val('');
  }

// Guardar actividad (MODIFICADO)
$("#saveActivity").click(function() {
  if (!$("#actTitle").val() || !$("#actDuration").val() || !$("#actType").val() || 
      !$("#actMethod").val() || !$("#actDescription").val()) {
    alert("Complete todos los campos requeridos");
    return;
  }

  // Recopilar recursos agregados para esta actividad
  const recursosActividad = [];
  $("#recursosAgregados .custom-resource-item").each(function() {
    const recurso = {
      id: $(this).data('resource-id'),
      tipo: $(this).find('i').hasClass('fa-youtube') ? 'youtube' : 
            $(this).find('i').hasClass('fa-link') ? 'enlace' :
            $(this).find('i').hasClass('fa-file-alt') ? 'archivo' :
            $(this).find('i').hasClass('fa-cube') ? 'material' :
            $(this).find('i').hasClass('fa-book') ? 'biblioteca' : 'abc_nube',
      nombre: $(this).find('span').first().text().trim(),
      url: $(this).find('.resource-link').attr('href') || null
    };
    recursosActividad.push(recurso);
  });

  const activity = {
    id: editIndex >= 0 ? activities[editIndex].id : Date.now(),
    title: $("#actTitle").val(),
    duration: $("#actDuration").val(),
    type: $("#actType").val(),
    method: $("#actMethod").val(),
    description: $("#actDescription").val(),
    recursos: recursosActividad // NUEVO: incluir recursos
  };

  if (editIndex >= 0) {
    activities[editIndex] = activity;
  } else {
    activities.push(activity);
  }

  renderActivities();
  limpiarFormularioActividad(); // Nueva función para limpiar todo
  $("#activityModal").modal('hide');
});editActivity

// Renderizar actividades (MODIFICADO)
function renderActivities() {
  const container = $("#activitiesList");
  
  if (activities.length === 0) {
    container.html(`
      <div class="text-center text-muted">
        <i class="fas fa-clipboard-list fa-2x mb-2 opacity-50"></i>
        <p>No hay actividades. Haga clic en "Agregar Actividad" para comenzar.</p>
      </div>
    `);
    $("#ordenContainer").hide();
    return;
  }

  let html = '';
  activities.forEach((act, i) => {
    // Mostrar recursos si los hay
    let recursosHTML = '';
    if (act.recursos && act.recursos.length > 0) {
      recursosHTML = `
        <div class="mt-2">
          <small class="text-muted"><strong>Recursos:</strong> 
            ${act.recursos.map(r => r.nombre).join(', ')}
          </small>
        </div>
      `;
    }
    
    html += `
      <div class="card mb-2">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div class="flex-grow-1">
              <h6 class="card-title mb-1">${act.title} 
                <span class="badge bg-secondary">${act.duration} min</span>
                <span class="badge bg-${act.type === 'inicio' ? 'success' : act.type === 'desarrollo' ? 'primary' : 'warning'}">${act.type}</span>
              </h6>
              <p class="card-text small mb-1">${act.description}</p>
              <small class="text-muted">Método: ${act.method}</small>
              ${recursosHTML}
            </div>
            <div>
              <button class="btn btn-sm btn-outline-primary me-1" onclick="editActivity(${i})">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteActivity(${i})">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    `;
  });
  
  container.html(html);
  updateSortable();
  updateHiddenField();
  $("#ordenContainer").show();
}

 // Editar actividad (MODIFICADO)
window.editActivity = function(index) {
  editIndex = index;
  const act = activities[index];
  
  // Cargar datos básicos
  $("#actTitle").val(act.title);
  $("#actDuration").val(act.duration);
  $("#actType").val(act.type);
  $("#actMethod").val(act.method);
  $("#actDescription").val(act.description);
  
  // Cargar recursos si los hay
  limpiarFormularioActividad();
  if (act.recursos && act.recursos.length > 0) {
    act.recursos.forEach(recurso => {
      // Simular agregar el recurso a la lista visual
      agregarRecursoAListaEdit(recurso);
    });
  }
  
  $("#activityModal").modal('show');
};

  window.deleteActivity = function(index) {
    if (confirm('¿Eliminar actividad?')) {
      activities.splice(index, 1);
      renderActivities();
    }
  };

  // Lista ordenable
  function updateSortable() {
    const sortable = $("#sortableList");
    sortable.empty();
    
    activities.forEach(act => {
      sortable.append(`
        <div class="list-group-item" data-id="${act.id}">
          <i class="fas fa-grip-vertical me-2" style="cursor: grab;"></i>
          ${act.title} <span class="badge bg-light text-dark">${act.duration} min</span>
        </div>
      `);
    });

    sortable.sortable({
      handle: '.fa-grip-vertical',
      update: function() {
        const newOrder = [];
        $(this).children().each(function() {
          const id = $(this).data('id');
          const activity = activities.find(a => a.id == id);
          if (activity) newOrder.push(activity);
        });
        activities = newOrder;
        updateHiddenField();
      }
    });
  }

  function updateHiddenField() {
    $("#actividadesData").val(JSON.stringify(activities));
  }

  // Validación para el wizard
  window.validateStep3 = function() {
    return activities.length > 0;
  };
});

// JAVASCRIPT PARA EL PASO 2 REESTRUCTURADO - AGREGAR AL SCRIPT EXISTENTE

// Competencias por área (expandido)
const competenciasPorArea = {
  matematicas: [
    "Resuelve problemas utilizando operaciones matemáticas básicas",
    "Comprende y aplica conceptos geométricos y espaciales",
    "Interpreta y analiza datos estadísticos simples",
    "Desarrolla el razonamiento lógico-matemático",
    "Utiliza estrategias de cálculo mental y estimación"
  ],
  lenguaje: [
    "Comprende textos orales y escritos de diversa tipología",
    "Produce textos escritos con coherencia y cohesión",
    "Utiliza la lengua de forma creativa y expresiva",
    "Reflexiona sobre el uso correcto de la lengua",
    "Desarrolla habilidades de comunicación oral efectiva"
  ],
  ciencias_naturales: [
    "Investiga fenómenos naturales del entorno",
    "Comprende procesos biológicos fundamentales",
    "Analiza el impacto humano en el medio ambiente",
    "Aplica el método científico en investigaciones simples",
    "Relaciona la ciencia con la vida cotidiana"
  ],
  ciencias_sociales: [
    "Analiza procesos históricos y sociales relevantes",
    "Interpreta mapas y representaciones geográficas",
    "Reconoce y ejerce sus derechos y deberes ciudadanos",
    "Participa activamente en su comunidad",
    "Comprende la diversidad cultural de su entorno"
  ],
  educacion_artistica: [
    "Expresa ideas y emociones a través del arte",
    "Utiliza técnicas artísticas básicas",
    "Aprecia las manifestaciones artísticas culturales",
    "Desarrolla creatividad e imaginación",
    "Participa en actividades artísticas colaborativas"
  ],
  educacion_fisica: [
    "Practica actividades físicas para una vida saludable",
    "Muestra respeto por las reglas y el trabajo en equipo",
    "Desarrolla habilidades motrices básicas",
    "Aplica estrategias en juegos y deportes",
    "Adopta hábitos de higiene y cuidado personal"
  ],
  formacion_humana: [
    "Reflexiona sobre valores personales y sociales",
    "Toma decisiones responsables en su vida diaria",
    "Fomenta el respeto y la empatía hacia otros",
    "Participa en acciones solidarias comunitarias",
    "Desarrolla su identidad personal y cultural"
  ],
  ingles: [
    "Comprende instrucciones y mensajes orales en inglés",
    "Lee y comprende textos breves en inglés",
    "Escribe frases y párrafos sencillos",
    "Mantiene intercambios básicos en conversaciones",
    "Utiliza vocabulario básico en contextos familiares"
  ],
  frances: [
    "Comprende y utiliza expresiones cotidianas en francés",
    "Lee textos sencillos en lengua francesa",
    "Escribe frases breves con vocabulario básico",
    "Participa en interacciones básicas en francés",
    "Reconoce aspectos culturales francófonos"
  ],
  educacion_tecnica: [
    "Aplica conocimientos técnicos en proyectos prácticos",
    "Utiliza herramientas y equipos de manera segura",
    "Desarrolla soluciones a problemas técnicos",
    "Comprende principios tecnológicos básicos",
    "Trabaja colaborativamente en proyectos técnicos"
  ]
};

// Variables globales para el paso 2
let competenciasSeleccionadas = [];
let contenidosSeleccionados = {
  conceptuales: [],
  procedimentales: [],
  actitudinales: []
};
let indicadoresSeleccionados = [];

// Inicializar el paso 2
$(document).ready(function() {
  // Gestionar cambio de área/asignatura
  $("#areaAsignatura").change(function() {
    const area = $(this).val();
    
    if (area === "otra") {
      $("#areaAsignaturaOtra").removeClass("d-none");
    } else {
      $("#areaAsignaturaOtra").addClass("d-none");
      cargarCompetencias(area);
    }
    
    marcarSeccionCompleta("area-section");
  });

  // Gestionar competencias personalizadas
  $("#btnAgregarCompetencia").click(function() {
    const competencia = $("#nuevaCompetencia").val().trim();
    if (competencia) {
      agregarCompetenciaPersonalizada(competencia);
      $("#nuevaCompetencia").val("");
    }
  });

  $("#nuevaCompetencia").keypress(function(e) {
    if (e.which === 13) {
      $("#btnAgregarCompetencia").click();
    }
  });

  // Gestionar indicadores personalizados
  $("#btnAgregarIndicador").click(function() {
    const indicador = $("#nuevoIndicador").val().trim();
    if (indicador) {
      agregarIndicadorPersonalizado(indicador);
      $("#nuevoIndicador").val("");
    }
  });

  $("#nuevoIndicador").keypress(function(e) {
    if (e.which === 13) {
      $("#btnAgregarIndicador").click();
    }
  });

  // Gestionar inputs de contenidos con Enter
  $("#inputConceptual, #inputProcedimental, #inputActitudinal").keypress(function(e) {
    if (e.which === 13) {
      const tipo = $(this).attr('id').replace('input', '').toLowerCase();
      agregarContenido(tipo);
    }
  });
});

// Cargar competencias según el área seleccionada
function cargarCompetencias(area) {
  const competencias = competenciasPorArea[area] || [];
  const grid = $("#competenciasGrid");
  
  grid.empty();
  
  if (competencias.length === 0) {
    grid.html(`
      <div class="empty-state">
        <i class="fas fa-graduation-cap"></i>
        <p>No hay competencias predefinidas para esta área</p>
      </div>
    `);
    return;
  }

  competencias.forEach((competencia, index) => {
    const competenciaId = `${area}_${index}`;
    const card = $(`
      <div class="competency-card" data-id="${competenciaId}" data-text="${competencia}">
        ${competencia}
        <i class="fas fa-check-circle check-icon"></i>
      </div>
    `);
    
    grid.append(card);
  });

  // Event listeners para las tarjetas de competencias
  $(".competency-card").click(function() {
    toggleCompetencia($(this));
  });

  generarIndicadoresAutomaticos();
}

// Alternar selección de competencia
function toggleCompetencia($card) {
  const competenciaId = $card.data("id");
  const competenciaText = $card.data("text");
  
  $card.toggleClass("selected");
  
  if ($card.hasClass("selected")) {
    if (!competenciasSeleccionadas.find(c => c.id === competenciaId)) {
      competenciasSeleccionadas.push({
        id: competenciaId,
        text: competenciaText,
        custom: $card.hasClass("custom")
      });
    }
  } else {
    competenciasSeleccionadas = competenciasSeleccionadas.filter(c => c.id !== competenciaId);
  }
  
  actualizarCompetenciasSeleccionadas();
  generarIndicadoresAutomaticos();
  marcarSeccionCompleta("competencias-section");
}

// Agregar competencia personalizada
function agregarCompetenciaPersonalizada(texto) {
  const competenciaId = `custom_${Date.now()}`;
  const grid = $("#competenciasGrid");
  
  // Remover empty state si existe
  grid.find(".empty-state").remove();
  
  const card = $(`
    <div class="competency-card custom" data-id="${competenciaId}" data-text="${texto}">
      ${texto}
      <i class="fas fa-check-circle check-icon"></i>
    </div>
  `);
  
  grid.append(card);
  
  // Seleccionar automáticamente
  card.addClass("selected");
  competenciasSeleccionadas.push({
    id: competenciaId,
    text: texto,
    custom: true
  });
  
  card.click(function() {
    toggleCompetencia($(this));
  });
  
  actualizarCompetenciasSeleccionadas();
  generarIndicadoresAutomaticos();
  marcarSeccionCompleta("competencias-section");
}

// Actualizar campo oculto de competencias
function actualizarCompetenciasSeleccionadas() {
  $("#competenciasSeleccionadas").val(JSON.stringify(competenciasSeleccionadas));
}

// Función para agregar contenidos
function agregarContenido(tipo) {
  const input = $(`#input${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
  const contenido = input.val().trim();
  
  if (contenido) {
    const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
    const lista = $(`#lista${tipo.charAt(0).toUpperCase() + tipo.slice(1)}es`);
    
    // Agregar al array
    contenidosSeleccionados[tipoPlural].push(contenido);
    
    // Crear tag visual
    const tag = $(`
      <div class="content-tag" data-tipo="${tipo}" data-contenido="${contenido}">
        ${contenido}
        <span class="remove-tag" onclick="eliminarContenido('${tipo}', '${contenido}')">&times;</span>
      </div>
    `);
    
    lista.append(tag);
    input.val("");
    
    // Actualizar contador
    actualizarContadorContenidos(tipo);
    actualizarContenidosSeleccionados();
    marcarSeccionCompleta("contenidos-section");
  }
}

// Eliminar contenido
function eliminarContenido(tipo, contenido) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  
  // Remover del array
  contenidosSeleccionados[tipoPlural] = contenidosSeleccionados[tipoPlural].filter(c => c !== contenido);
  
  // Remover del DOM
  $(`.content-tag[data-tipo="${tipo}"][data-contenido="${contenido}"]`).remove();
  
  // Actualizar contador
  actualizarContadorContenidos(tipo);
  actualizarContenidosSeleccionados();
  verificarSeccionContenidos();
}

// Actualizar contador de contenidos
function actualizarContadorContenidos(tipo) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  const count = contenidosSeleccionados[tipoPlural].length;
  $(`#count-${tipoPlural}`).text(count);
}

// Actualizar campo oculto de contenidos
function actualizarContenidosSeleccionados() {
  $("#contenidosSeleccionados").val(JSON.stringify(contenidosSeleccionados));
}

// Verificar si la sección de contenidos está completa
function verificarSeccionContenidos() {
  const totalContenidos = Object.values(contenidosSeleccionados).reduce((total, arr) => total + arr.length, 0);
  if (totalContenidos > 0) {
    marcarSeccionCompleta("contenidos-section");
  } else {
    desmarcarSeccionCompleta("contenidos-section");
  }
}

// Generar indicadores automáticamente basados en competencias
function generarIndicadoresAutomaticos() {
  const indicadoresContainer = $("#indicadoresLista");
  
  if (competenciasSeleccionadas.length === 0) {
    indicadoresContainer.html(`
      <div class="empty-state">
        <i class="fas fa-bullseye"></i>
        <p>Seleccione competencias para generar indicadores automáticamente</p>
      </div>
    `);
    return;
  }
  
  // Limpiar indicadores existentes (mantener solo los personalizados)
  indicadoresContainer.find('.indicator-item:not(.custom)').remove();
  indicadoresContainer.find('.empty-state').remove();
  
  // Generar indicadores basados en las competencias seleccionadas
  const indicadoresGenerados = [
    "Demuestra comprensión de los conceptos fundamentales",
    "Aplica conocimientos en situaciones prácticas",
    "Analiza y resuelve problemas de forma sistemática",
    "Comunica ideas y resultados de manera clara",
    "Trabaja de forma autónoma y responsable",
    "Colabora efectivamente con sus compañeros"
  ];
  
  indicadoresGenerados.forEach((indicador, index) => {
    const indicadorId = `auto_${index}`;
    const indicadorItem = $(`
      <div class="indicator-item" data-id="${indicadorId}">
        <input type="checkbox" class="form-check-input" id="${indicadorId}" value="${indicadorId}">
        <label class="form-check-label" for="${indicadorId}">${indicador}</label>
      </div>
    `);
    
    indicadoresContainer.append(indicadorItem);
  });
  
  // Event listeners para checkboxes de indicadores
  $(".indicator-item input[type='checkbox']").change(function() {
    const $item = $(this).closest('.indicator-item');
    const indicadorId = $(this).val();
    const indicadorText = $(this).next('label').text();
    
    if ($(this).is(':checked')) {
      $item.addClass('selected');
      if (!indicadoresSeleccionados.find(i => i.id === indicadorId)) {
        indicadoresSeleccionados.push({
          id: indicadorId,
          text: indicadorText,
          custom: $item.hasClass('custom')
        });
      }
    } else {
      $item.removeClass('selected');
      indicadoresSeleccionados = indicadoresSeleccionados.filter(i => i.id !== indicadorId);
    }
    
    actualizarIndicadoresSeleccionados();
    marcarSeccionCompleta("indicadores-section");
  });
}

// Agregar indicador personalizado
function agregarIndicadorPersonalizado(texto) {
  const indicadorId = `custom_${Date.now()}`;
  const indicadoresContainer = $("#indicadoresLista");
  
  // Remover empty state si existe
  indicadoresContainer.find(".empty-state").remove();
  
  const indicadorItem = $(`
    <div class="indicator-item custom selected" data-id="${indicadorId}">
      <input type="checkbox" class="form-check-input" id="${indicadorId}" value="${indicadorId}" checked>
      <label class="form-check-label" for="${indicadorId}">${texto}</label>
      <button type="button" class="btn btn-sm btn-outline-danger ms-auto" onclick="eliminarIndicadorPersonalizado('${indicadorId}')">
        <i class="fas fa-times"></i>
      </button>
    </div>
  `);
  
  indicadoresContainer.append(indicadorItem);
  
  // Agregar al array
  indicadoresSeleccionados.push({
    id: indicadorId,
    text: texto,
    custom: true
  });
  
  // Event listener para el checkbox
  indicadorItem.find('input[type="checkbox"]').change(function() {
    const $item = $(this).closest('.indicator-item');
    const indicadorId = $(this).val();
    const indicadorText = $(this).next('label').text();
    
    if ($(this).is(':checked')) {
      $item.addClass('selected');
      if (!indicadoresSeleccionados.find(i => i.id === indicadorId)) {
        indicadoresSeleccionados.push({
          id: indicadorId,
          text: indicadorText,
          custom: true
        });
      }
    } else {
      $item.removeClass('selected');
      indicadoresSeleccionados = indicadoresSeleccionados.filter(i => i.id !== indicadorId);
    }
    
    actualizarIndicadoresSeleccionados();
    marcarSeccionCompleta("indicadores-section");
  });
  
  actualizarIndicadoresSeleccionados();
  marcarSeccionCompleta("indicadores-section");
}

// Eliminar indicador personalizado
function eliminarIndicadorPersonalizado(indicadorId) {
  // Remover del DOM
  $(`.indicator-item[data-id="${indicadorId}"]`).remove();
  
  // Remover del array
  indicadoresSeleccionados = indicadoresSeleccionados.filter(i => i.id !== indicadorId);
  
  actualizarIndicadoresSeleccionados();
  verificarSeccionIndicadores();
}

// Actualizar campo oculto de indicadores
function actualizarIndicadoresSeleccionados() {
  $("#indicadoresSeleccionados").val(JSON.stringify(indicadoresSeleccionados));
}

// Verificar si la sección de indicadores está completa
function verificarSeccionIndicadores() {
  if (indicadoresSeleccionados.length > 0) {
    marcarSeccionCompleta("indicadores-section");
  } else {
    desmarcarSeccionCompleta("indicadores-section");
  }
}

// Marcar sección como completa
function marcarSeccionCompleta(seccionId) {
  const $seccion = $(`#${seccionId}`);
  $seccion.addClass('completed');
  $seccion.find('.completion-indicator').removeClass('d-none');
}

// Desmarcar sección como completa
function desmarcarSeccionCompleta(seccionId) {
  const $seccion = $(`#${seccionId}`);
  $seccion.removeClass('completed');
  $seccion.find('.completion-indicator').addClass('d-none');
}

// Validación del paso 2 (para integrar con el wizard)
function validateStep2() {
  const area = $("#areaAsignatura").val();
  const competencias = competenciasSeleccionadas.length;
  const totalContenidos = Object.values(contenidosSeleccionados).reduce((total, arr) => total + arr.length, 0);
  const indicadores = indicadoresSeleccionados.length;
  
  // Validar área "otra"
  if (area === "otra") {
    const otraArea = $("#areaAsignaturaOtra input").val().trim();
    if (!otraArea) return false;
  }
  
  return area && competencias > 0 && totalContenidos > 0 && indicadores > 0;
}

// Función para resetear el paso 2 (si es necesario)
function resetStep2() {
  competenciasSeleccionadas = [];
  contenidosSeleccionados = {
    conceptuales: [],
    procedimentales: [],
    actitudinales: []
  };
  indicadoresSeleccionados = [];
  
  $("#areaAsignatura").val("");
  $("#areaAsignaturaOtra").addClass("d-none");
  $("#competenciasGrid").html(`
    <div class="empty-state">
      <i class="fas fa-graduation-cap"></i>
      <p>Seleccione un área para ver las competencias disponibles</p>
    </div>
  `);
  
  // Limpiar contenidos
  $(".content-tags-area").empty();
  $(".content-count").text("0");
  
  // Limpiar indicadores
  $("#indicadoresLista").html(`
    <div class="empty-state">
      <i class="fas fa-bullseye"></i>
      <p>Seleccione competencias para generar indicadores automáticamente</p>
    </div>
  `);
  
  // Limpiar campos ocultos
  $("#competenciasSeleccionadas, #contenidosSeleccionados, #indicadoresSeleccionados").val("");
  
  // Desmarcar todas las secciones
  $(".curriculum-section").removeClass("completed");
  $(".completion-indicator").addClass("d-none");
}

const contenidosPorArea = {

  matematicas: {
  preescolar: {
    conceptuales: ["Números del 1 al 10", "Formas básicas"],
    procedimentales: ["Contar hasta 10", "Clasificar por forma"],
    actitudinales: ["Interés por los números", "Disfrute en juegos"]
  },
  primaria: {
    conceptuales: ["Suma, resta, multiplicación", "Fracciones"],
    procedimentales: ["Resolver operaciones", "Medir objetos"],
    actitudinales: ["Precisión", "Perseverancia"]
  },
  secundaria: {
    conceptuales: ["Álgebra", "Geometría", "Estadística"],
    procedimentales: ["Graficar funciones", "Resolver ecuaciones"],
    actitudinales: ["Razonamiento lógico", "Apreciación matemática"]
  }
},
lenguaje: {
  preescolar: {
    conceptuales: ["Abecedario", "Rimas"],
    procedimentales: ["Trazar letras", "Escuchar cuentos"],
    actitudinales: ["Amor por la lectura", "Curiosidad"]
  },
  primaria: {
    conceptuales: ["Tipos de texto", "Gramática básica"],
    procedimentales: ["Escribir oraciones", "Leer en voz alta"],
    actitudinales: ["Responsabilidad comunicativa", "Creatividad"]
  },
  secundaria: {
    conceptuales: ["Análisis literario", "Pragmática"],
    procedimentales: ["Escribir ensayos", "Debatir"],
    actitudinales: ["Pensamiento crítico", "Apreciación literaria"]
  }
},
ciencias_naturales: {
  preescolar: {
    conceptuales: ["Los cinco sentidos", "Animales"],
    procedimentales: ["Observar", "Clasificar"],
    actitudinales: ["Asombro", "Cuidado de la naturaleza"]
  },
  primaria: {
    conceptuales: ["Sistema solar", "Ciclo del agua"],
    procedimentales: ["Hacer experimentos", "Usar instrumentos"],
    actitudinales: ["Interés por la ciencia", "Precisión"]
  },
  secundaria: {
    conceptuales: ["Célula", "Energía", "Química básica"],
    procedimentales: ["Usar laboratorio", "Analizar datos"],
    actitudinales: ["Ética científica", "Valor del conocimiento"]
  }
},
ciencias_sociales: {
  preescolar: {
    conceptuales: ["Familia", "Normas", "Comunidad"],
    procedimentales: ["Reconocer roles", "Participar en grupo"],
    actitudinales: ["Orgullo patrio", "Solidaridad"]
  },
  primaria: {
    conceptuales: ["Historia dominicana", "Derechos del niño"],
    procedimentales: ["Investigar", "Interpretar mapas"],
    actitudinales: ["Participación", "Respeto a la diversidad"]
  },
  secundaria: {
    conceptuales: ["Democracia", "Globalización", "Derechos humanos"],
    procedimentales: ["Analizar procesos", "Debatir"],
    actitudinales: ["Conciencia histórica", "Compromiso social"]
  }
},
educacion_artistica: {
  preescolar: {
    conceptuales: ["Colores", "Ritmos"],
    procedimentales: ["Pintar", "Cantar"],
    actitudinales: ["Expresión libre", "Respeto por el arte"]
  },
  primaria: {
    conceptuales: ["Elementos visuales", "Técnicas artísticas"],
    procedimentales: ["Dibujar", "Dramatizar"],
    actitudinales: ["Valoración cultural", "Disciplina creativa"]
  },
  secundaria: {
    conceptuales: ["Historia del arte", "Arte contemporáneo"],
    procedimentales: ["Crear proyectos", "Usar software de diseño"],
    actitudinales: ["Apreciación crítica", "Innovación"]
  }
},

  formacion_humana: {
    preescolar: {
      conceptuales: [
        "Valores: respeto, amistad, responsabilidad",
        "Partes del cuerpo y cuidado personal",
        "Mi familia y la comunidad",
        "Normas básicas de convivencia",
        "Dios y la creación"
      ],
      procedimentales: [
        "Saludar y despedirse con cortesía",
        "Cuidar su cuerpo e higiene",
        "Colaborar en tareas sencillas",
        "Reconocer emociones propias y ajenas",
        "Orar y agradecer"
      ],
      actitudinales: [
        "Amor por la familia y amigos",
        "Respeto por los demás",
        "Alegría al compartir",
        "Empatía con sus compañeros",
        "Agradecimiento a Dios"
      ]
    },
    primaria: {
      conceptuales: [
        "Los valores en la vida diaria",
        "La familia como núcleo social",
        "Relación con Dios y los demás",
        "Convivencia pacífica",
        "Solidaridad y justicia"
      ],
      procedimentales: [
        "Practicar valores en el aula",
        "Resolver conflictos pacíficamente",
        "Participar en campañas solidarias",
        "Reflexionar sobre decisiones éticas",
        "Realizar oraciones y reflexiones"
      ],
      actitudinales: [
        "Actuar con honestidad",
        "Mostrar empatía y solidaridad",
        "Responsabilidad en sus acciones",
        "Actitud reflexiva y crítica",
        "Interés por mejorar como persona"
      ]
    },
    secundaria: {
      conceptuales: [
        "Identidad personal y vocación",
        "Ética y moral en la adolescencia",
        "Relaciones humanas sanas",
        "Justicia social y derechos humanos",
        "Dimensión espiritual del ser humano"
      ],
      procedimentales: [
        "Analizar dilemas éticos",
        "Participar en debates sobre valores",
        "Diseñar proyectos de acción solidaria",
        "Reflexionar sobre decisiones personales",
        "Elaborar compromisos personales"
      ],
      actitudinales: [
        "Compromiso con el bien común",
        "Apertura al diálogo",
        "Valoración de la dignidad humana",
        "Espiritualidad consciente",
        "Responsabilidad social"
      ]
    }
  },

  ingles: {
    preescolar: {
      conceptuales: [
        "Greetings and farewells",
        "Colors and numbers",
        "Basic vocabulary: animals, objects, family",
        "Body parts",
        "Classroom commands"
      ],
      procedimentales: [
        "Sing simple songs",
        "Identify objects by name",
        "Repeat vocabulary",
        "Point to body parts",
        "Respond to basic commands"
      ],
      actitudinales: [
        "Interest in learning English",
        "Enjoyment in songs and games",
        "Participation in group activities",
        "Respect for language differences"
      ]
    },
    primaria: {
      conceptuales: [
        "Basic sentence structures",
        "Vocabulary expansion: food, clothes, school",
        "Personal information",
        "Daily routines",
        "Simple present and past tense"
      ],
      procedimentales: [
        "Introduce oneself",
        "Ask and answer simple questions",
        "Write short sentences",
        "Describe routines",
        "Read and understand short texts"
      ],
      actitudinales: [
        "Confidence when speaking",
        "Appreciation for other cultures",
        "Effort in communication",
        "Interest in reading and writing in English"
      ]
    },
    secundaria: {
      conceptuales: [
        "Verb tenses and grammar",
        "Reading comprehension strategies",
        "Functional language (requests, offers)",
        "Cultural aspects of English-speaking countries",
        "Essay and paragraph writing"
      ],
      procedimentales: [
        "Write and revise texts",
        "Participate in dialogues",
        "Listen for specific information",
        "Give oral presentations",
        "Interpret authentic texts"
      ],
      actitudinales: [
        "Autonomy in language learning",
        "Appreciation for multiculturalism",
        "Perseverance in speaking practice",
        "Respect in communication"
      ]
    }
  },

  frances: {
    preescolar: {
      conceptuales: [
        "Salutations de base",
        "Couleurs et chiffres",
        "Vocabulaire: animaux, objets",
        "Parties du corps",
        "Consignes simples"
      ],
      procedimentales: [
        "Chanter des chansons",
        "Répondre à des consignes",
        "Associer mots et images",
        "Répéter des mots en français"
      ],
      actitudinales: [
        "Curiosité pour la langue",
        "Joie d’apprendre avec des chansons",
        "Respect des différences linguistiques"
      ]
    },
    primaria: {
      conceptuales: [
        "Présentation personnelle",
        "Nombres, jours, mois",
        "Famille et amis",
        "École et maison",
        "Verbes de base"
      ],
      procedimentales: [
        "Se présenter",
        "Nommer des objets quotidiens",
        "Écrire des phrases simples",
        "Comprendre des instructions",
        "Lire des textes courts"
      ],
      actitudinales: [
        "Motivation pour apprendre",
        "Respect pour les autres cultures",
        "Volonté de communiquer"
      ]
    },
    secundaria: {
      conceptuales: [
        "Structures grammaticales",
        "Communication écrite et orale",
        "Culture francophone",
        "Descriptions et opinions",
        "Expression écrite"
      ],
      procedimentales: [
        "Participer à des dialogues",
        "Rédiger des textes",
        "Comprendre des conversations",
        "Utiliser des expressions usuelles"
      ],
      actitudinales: [
        "Ouverture culturelle",
        "Confiance dans la pratique",
        "Persévérance linguistique"
      ]
    }
  },

  educacion_fisica: {
    preescolar: {
      conceptuales: [
        "Partes del cuerpo",
        "Movimientos básicos: correr, saltar",
        "Coordinación motora",
        "Normas de juego"
      ],
      procedimentales: [
        "Ejecutar juegos con reglas simples",
        "Practicar equilibrio y coordinación",
        "Participar en juegos grupales",
        "Seguir instrucciones físicas"
      ],
      actitudinales: [
        "Disfrutar del juego",
        "Colaborar con sus compañeros",
        "Respetar turnos y reglas"
      ]
    },
    primaria: {
      conceptuales: [
        "Cualidades físicas: fuerza, velocidad",
        "Higiene y salud corporal",
        "Juegos tradicionales y deportivos",
        "Educación postural"
      ],
      procedimentales: [
        "Realizar calentamiento y estiramientos",
        "Participar en juegos cooperativos",
        "Mejorar habilidades físicas básicas",
        "Utilizar material deportivo correctamente"
      ],
      actitudinales: [
        "Valoración de la actividad física",
        "Respeto al cuerpo propio y ajeno",
        "Trabajo en equipo"
      ]
    },
    secundaria: {
      conceptuales: [
        "Sistemas energéticos en el cuerpo",
        "Reglas de deportes colectivos",
        "Nutrición y rendimiento físico",
        "Prevención de lesiones"
      ],
      procedimentales: [
        "Desarrollar rutinas de entrenamiento",
        "Participar en torneos escolares",
        "Analizar su propio rendimiento",
        "Promover estilos de vida saludables"
      ],
      actitudinales: [
        "Responsabilidad con la salud personal",
        "Esfuerzo y superación",
        "Juego limpio y respeto"
      ]
    }
  },

  educacion_tecnica: {
    secundaria: {
      conceptuales: [
        "Fundamentos de la tecnología",
        "Seguridad en el uso de herramientas",
        "Procesos productivos",
        "Diseño técnico y planos"
      ],
      procedimentales: [
        "Usar herramientas básicas",
        "Montar circuitos simples",
        "Interpretar planos",
        "Diseñar soluciones técnicas"
      ],
      actitudinales: [
        "Precisión en el trabajo manual",
        "Cumplimiento de normas de seguridad",
        "Iniciativa en la resolución de problemas"
      ]
    }
  }
};


// FUNCIÓN PRINCIPAL PARA CARGAR CONTENIDOS
function cargarContenidosPorArea() {
  const area = $("#areaAsignatura").val();
  const grado = $("#gradoInput").val();
  
  if (!area || area === "otra") {
    limpiarContenidos();
    return;
  }
  
  // Determinar el nivel basado en el grado seleccionado
  let nivel = 'primaria'; // por defecto
  
  if (grado === 'preescolar' || grado.includes('Preescolar')) {
    nivel = 'preescolar';
  } else if (grado === 'secundaria' || grado.includes('Secundaria')) {
    nivel = 'secundaria';
  }
  
  const contenidosArea = contenidosPorArea[area];
  
  if (contenidosArea && contenidosArea[nivel]) {
    mostrarContenidosSugeridos(contenidosArea[nivel]);
  } else {
    limpiarContenidos();
  }
}

// FUNCIÓN PARA MOSTRAR CONTENIDOS SUGERIDOS
function mostrarContenidosSugeridos(contenidos) {
  // Limpiar contenidos previos
  limpiarContenidos();
  
  // Agregar botones de sugerencias para cada tipo
  agregarSugerenciasContenido('conceptual', contenidos.conceptuales || []);
  agregarSugerenciasContenido('procedimental', contenidos.procedimentales || []);
  agregarSugerenciasContenido('actitudinal', contenidos.actitudinales || []);
}

// FUNCIÓN PARA AGREGAR SUGERENCIAS DE CONTENIDO
function agregarSugerenciasContenido(tipo, sugerencias) {
  const tipoCapitalizado = tipo.charAt(0).toUpperCase() + tipo.slice(1);
  const contenedorTab = $(`#${tipo}es`);
  
  // Crear sección de sugerencias si no existe
  let seccionSugerencias = contenedorTab.find('.sugerencias-contenido');
  if (seccionSugerencias.length === 0) {
    seccionSugerencias = $(`
      <div class="sugerencias-contenido mb-3">
        <h6 class="text-muted mb-2">
          <i class="fas fa-lightbulb me-2"></i>Contenidos sugeridos:
        </h6>
        <div class="sugerencias-grid">
          <!-- Las sugerencias se agregan aquí -->
        </div>
      </div>
    `);
    
    // Insertar antes del área de input
    contenedorTab.find('.content-input-area').before(seccionSugerencias);
  }
  
  const grid = seccionSugerencias.find('.sugerencias-grid');
  grid.empty();
  
  // Agregar cada sugerencia como botón clickeable
  sugerencias.forEach((contenido, index) => {
    const botonSugerencia = $(`
      <button type="button" class="btn btn-outline-secondary btn-sm sugerencia-btn me-2 mb-2" 
              data-tipo="${tipo}" data-contenido="${contenido}">
        <i class="fas fa-plus me-1"></i>${contenido}
      </button>
    `);
    
    grid.append(botonSugerencia);
  });
  
  // Event listener para los botones de sugerencias
  $('.sugerencia-btn').off('click').on('click', function() {
    const tipoContenido = $(this).data('tipo');
    const contenidoTexto = $(this).data('contenido');
    
    // Agregar el contenido sugerido
    agregarContenidoSugerido(tipoContenido, contenidoTexto);
    
    // Deshabilitar el botón para evitar duplicados
    $(this).prop('disabled', true).removeClass('btn-outline-secondary').addClass('btn-success');
    $(this).find('i').removeClass('fa-plus').addClass('fa-check');
  });
}

// FUNCIÓN PARA AGREGAR CONTENIDO SUGERIDO
function agregarContenidoSugerido(tipo, contenido) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  const lista = $(`#lista${tipo.charAt(0).toUpperCase() + tipo.slice(1)}es`);
  
  // Verificar si ya existe el contenido
  const existe = contenidosSeleccionados[tipoPlural].includes(contenido);
  if (existe) {
    return;
  }
  
  // Agregar al array
  contenidosSeleccionados[tipoPlural].push(contenido);
  
  // Crear tag visual
  const tag = $(`
    <div class="content-tag sugerido" data-tipo="${tipo}" data-contenido="${contenido}">
      <i class="fas fa-lightbulb me-1"></i>${contenido}
      <span class="remove-tag" onclick="eliminarContenido('${tipo}', '${contenido}')">&times;</span>
    </div>
  `);
  
  lista.append(tag);
  
  // Actualizar contador
  actualizarContadorContenidos(tipo);
  actualizarContenidosSeleccionados();
  marcarSeccionCompleta("contenidos-section");
}

// FUNCIÓN PARA LIMPIAR CONTENIDOS
function limpiarContenidos() {
  // Remover secciones de sugerencias existentes
  $('.sugerencias-contenido').remove();
  
  // Limpiar contenidos seleccionados si se desea empezar de cero
  // (comentado para mantener los contenidos ya agregados)
  /*
  contenidosSeleccionados = {
    conceptuales: [],
    procedimentales: [],
    actitudinales: []
  };
  
  $('.content-tags-area').empty();
  $('.content-count').text('0');
  actualizarContenidosSeleccionados();
  */
}

// FUNCIÓN PARA ELIMINAR CONTENIDO (MEJORADA)
function eliminarContenido(tipo, contenido) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  
  // Remover del array
  contenidosSeleccionados[tipoPlural] = contenidosSeleccionados[tipoPlural].filter(c => c !== contenido);
  
  // Remover del DOM
  $(`.content-tag[data-tipo="${tipo}"][data-contenido="${contenido}"]`).remove();
  
  // Reactivar botón de sugerencia si existe
  $(`.sugerencia-btn[data-tipo="${tipo}"][data-contenido="${contenido}"]`)
    .prop('disabled', false)
    .removeClass('btn-success')
    .addClass('btn-outline-secondary');
  $(`.sugerencia-btn[data-tipo="${tipo}"][data-contenido="${contenido}"] i`)
    .removeClass('fa-check')
    .addClass('fa-plus');
  
  // Actualizar contador
  actualizarContadorContenidos(tipo);
  actualizarContenidosSeleccionados();
  verificarSeccionContenidos();
}

// FUNCIÓN PARA AGREGAR CONTENIDO PERSONALIZADO (MEJORADA)
function agregarContenido(tipo) {
  const input = $(`#input${tipo.charAt(0).toUpperCase() + tipo.slice(1)}`);
  const contenido = input.val().trim();
  
  if (!contenido) {
    return;
  }
  
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  
  // Verificar si ya existe el contenido
  if (contenidosSeleccionados[tipoPlural].includes(contenido)) {
    alert('Este contenido ya ha sido agregado.');
    input.val('');
    return;
  }
  
  // Agregar al array
  contenidosSeleccionados[tipoPlural].push(contenido);
  
  // Crear tag visual
  const tag = $(`
    <div class="content-tag personalizado" data-tipo="${tipo}" data-contenido="${contenido}">
      <i class="fas fa-user-edit me-1"></i>${contenido}
      <span class="remove-tag" onclick="eliminarContenido('${tipo}', '${contenido}')">&times;</span>
    </div>
  `);
  
  const lista = $(`#lista${tipo.charAt(0).toUpperCase() + tipo.slice(1)}es`);
  lista.append(tag);
  input.val('');
  
  // Actualizar contador
  actualizarContadorContenidos(tipo);
  actualizarContenidosSeleccionados();
  marcarSeccionCompleta("contenidos-section");
}

// EVENT LISTENERS PARA INTEGRAR CON EL SISTEMA EXISTENTE
$(document).ready(function() {
  // Cargar contenidos cuando cambie el área o grado
  $("#areaAsignatura, #gradoInput").change(function() {
    setTimeout(cargarContenidosPorArea, 100); // Pequeño delay para asegurar que los valores estén actualizados
  });
  
  // También cargar cuando se seleccione el grado desde las tarjetas
  $(document).on('click', '.nivel-card', function() {
    setTimeout(cargarContenidosPorArea, 200);
  });
  
  // Cargar contenidos al cambiar grado detalle
  $("#gradoDetalle").change(function() {
    setTimeout(cargarContenidosPorArea, 100);
  });
});

// ESTILOS CSS ADICIONALES PARA LAS SUGERENCIAS
const estilosSugerencias = `
<style>
.sugerencias-contenido {
  background: linear-gradient(145deg, #f0f8ff 0%, #e6f3ff 100%);
  border: 2px dashed #b3d9ff;
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 1.5rem;
}

.sugerencias-contenido h6 {
  color: var(--secondary-color);
  font-weight: 600;
  margin-bottom: 1rem;
}

.sugerencias-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.sugerencia-btn {
  border-radius: 20px;
  font-size: 0.85rem;
  padding: 6px 12px;
  transition: all 0.3s ease;
  border: 2px solid #6c757d;
}

.sugerencia-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.sugerencia-btn:disabled {
  cursor: not-allowed;
  opacity: 0.7;
}

.content-tag.sugerido {
  background: linear-gradient(135deg, #17a2b8 0%, #20c997 100%);
  border-left: 4px solid #0056b3;
}

.content-tag.personalizado {
  background: linear-gradient(135deg, var(--secondary-color) 0%, var(--accent-color) 100%);
  border-left: 4px solid #0056b3;
}

.content-tag.sugerido i,
.content-tag.personalizado i {
  opacity: 0.8;
}

@media (max-width: 768px) {
  .sugerencias-grid {
    flex-direction: column;
  }
  
  .sugerencia-btn {
    width: 100%;
    text-align: left;
  }
}
</style>
`;

// Agregar estilos al head si no existen
if (!document.querySelector('#estilos-sugerencias')) {
  const style = document.createElement('style');
  style.id = 'estilos-sugerencias';
  style.textContent = estilosSugerencias.replace(/<style>|<\/style>/g, '');
  document.head.appendChild(style);
}

// FUNCIÓN PARA DETECTAR EL NIVEL EDUCATIVO
function detectarNivel() {
  const grado = $("#gradoInput").val();
  const gradoDetalle = $("#gradoDetalle").val();
  
  console.log("Grado detectado:", grado, "Detalle:", gradoDetalle);
  
  if (grado === 'preescolar' || (gradoDetalle && gradoDetalle.includes('Preescolar'))) {
    return 'preescolar';
  } else if (grado === 'secundaria' || (gradoDetalle && gradoDetalle.includes('Secundaria'))) {
    return 'secundaria';
  } else {
    return 'primaria';
  }
}

// FUNCIÓN PRINCIPAL PARA CARGAR CONTENIDOS
function cargarContenidosAutomaticos() {
  const area = $("#areaAsignatura").val();
  
  console.log("Cargando contenidos para área:", area);
  
  if (!area || area === "otra") {
    console.log("Área no válida, limpiando contenidos");
    return;
  }
  
  const nivel = detectarNivel();
  console.log("Nivel detectado:", nivel);
  
  const contenidosArea = contenidosPorArea[area];
  
  if (contenidosArea && contenidosArea[nivel]) {
    console.log("Contenidos encontrados:", contenidosArea[nivel]);
    mostrarSugerenciasContenidos(contenidosArea[nivel]);
  } else {
    console.log("No se encontraron contenidos para", area, nivel);
  }
}

// FUNCIÓN PARA MOSTRAR SUGERENCIAS
function mostrarSugerenciasContenidos(contenidos) {
  console.log("Mostrando sugerencias:", contenidos);
  
  // Agregar sugerencias para cada tipo
  if (contenidos.conceptuales) {
    agregarSugerencias('conceptual', contenidos.conceptuales);
  }
  if (contenidos.procedimentales) {
    agregarSugerencias('procedimental', contenidos.procedimentales);
  }
  if (contenidos.actitudinales) {
    agregarSugerencias('actitudinal', contenidos.actitudinales);
  }
}

// FUNCIÓN PARA AGREGAR SUGERENCIAS A CADA TAB
function agregarSugerencias(tipo, sugerencias) {
  const tipoCapitalizado = tipo.charAt(0).toUpperCase() + tipo.slice(1);
  const tabPane = $(`#${tipo}es`);
  
  console.log(`Agregando sugerencias ${tipo}:`, sugerencias);
  
  // Remover sugerencias previas
  tabPane.find('.sugerencias-contenido').remove();
  
  if (sugerencias.length === 0) return;
  
  // Crear HTML de sugerencias
  const sugerenciasHTML = `
    <div class="sugerencias-contenido alert alert-info p-3 mb-3">
      <h6 class="mb-3">
        <i class="fas fa-lightbulb me-2"></i>Contenidos ${tipo}s sugeridos:
      </h6>
      <div class="d-flex flex-wrap gap-2">
        ${sugerencias.map(contenido => `
          <button type="button" class="btn btn-outline-primary btn-sm sugerencia-btn" 
                  data-tipo="${tipo}" data-contenido="${contenido}">
            <i class="fas fa-plus me-1"></i>${contenido}
          </button>
        `).join('')}
      </div>
    </div>
  `;
  
  tabPane.find('.content-input-area').before(sugerenciasHTML);
  
  tabPane.find('.sugerencia-btn').off('click').on('click', function() {
    const tipoContenido = $(this).data('tipo');
    const contenidoTexto = $(this).data('contenido');
    
    console.log("Agregando contenido sugerido:", tipoContenido, contenidoTexto);
    
    // Usar la función existente de agregar contenido
    agregarContenidoSugerido(tipoContenido, contenidoTexto);
    
    // Deshabilitar botón
    $(this).prop('disabled', true)
           .removeClass('btn-outline-primary')
           .addClass('btn-success')
           .find('i')
           .removeClass('fa-plus')
           .addClass('fa-check');
  });
}

// FUNCIÓN PARA AGREGAR CONTENIDO SUGERIDO
function agregarContenidoSugerido(tipo, contenido) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  
  // Verificar si ya existe
  if (contenidosSeleccionados[tipoPlural].includes(contenido)) {
    console.log("Contenido ya existe:", contenido);
    return;
  }
  
  // Agregar al array global
  contenidosSeleccionados[tipoPlural].push(contenido);
  
  // Crear tag visual
  const tag = $(`
    <div class="content-tag" data-tipo="${tipo}" data-contenido="${contenido}">
      <i class="fas fa-lightbulb me-1"></i>${contenido}
      <span class="remove-tag" onclick="eliminarContenido('${tipo}', '${contenido}')">&times;</span>
    </div>
  `);
  
  // Agregar a la lista visual
  const lista = $(`#lista${tipo.charAt(0).toUpperCase() + tipo.slice(1)}es`);
  lista.append(tag);
  
  // Actualizar contador y campo oculto
  actualizarContadorContenidos(tipo);
  actualizarContenidosSeleccionados();
  marcarSeccionCompleta("contenidos-section");
  
  console.log("Contenido agregado exitosamente:", contenido);
}

// INTEGRAR CON LOS EVENT LISTENERS EXISTENTES
$(document).ready(function() {
  console.log("Iniciando sistema de contenidos automáticos");
  
  // Event listener para cambio de área
  $("#areaAsignatura").on('change', function() {
    console.log("Área cambiada a:", $(this).val());
    setTimeout(cargarContenidosAutomaticos, 300);
  });
  
  // Event listener para cambio de grado (tarjetas)
  $(document).on('click', '.nivel-card', function() {
    console.log("Nivel seleccionado:", $(this).data('value'));
    setTimeout(cargarContenidosAutomaticos, 500);
  });
  
  // Event listener para cambio de grado detalle
  $("#gradoDetalle").on('change', function() {
    console.log("Grado detalle cambiado:", $(this).val());
    setTimeout(cargarContenidosAutomaticos, 300);
  });
  
  // Cargar contenidos si ya hay valores seleccionados
  if ($("#areaAsignatura").val() && $("#gradoInput").val()) {
    setTimeout(cargarContenidosAutomaticos, 500);
  }
});

function agregarContenido(tipo) {
  const inputId = {
    conceptual: 'inputConceptual',
    procedimental: 'inputProcedimental',
    actitudinal: 'inputActitudinal'
  }[tipo];

  const listaId = {
    conceptual: 'listaConceptuales',
    procedimental: 'listaProcedimentales',
    actitudinal: 'listaActitudinales'
  }[tipo];

  const countId = {
    conceptual: 'count-conceptuales',
    procedimental: 'count-procedimentales',
    actitudinal: 'count-actitudinales'
  }[tipo];

  const input = document.getElementById(inputId);
  const lista = document.getElementById(listaId);
  const count = document.getElementById(countId);

  const valor = input.value.trim();
  if (valor !== "") {
    // Crear el tag visual
    const tag = document.createElement("div");
    tag.className = "content-tag";
    tag.innerHTML = `${valor}<span class="remove-tag ms-2">&times;</span>`;
    
    // Evento para eliminar el tag
    tag.querySelector(".remove-tag").addEventListener("click", () => {
      tag.remove();
      actualizarContador(lista, count);
    });

    lista.appendChild(tag);
    input.value = "";
    actualizarContador(lista, count);
  }
}

function actualizarContador(lista, countElement) {
  const total = lista.querySelectorAll('.content-tag').length;
  countElement.textContent = total;
}

// Variables para competencias fundamentales
let competenciasFundamentalesSeleccionadas = [];

// Inicializar competencias fundamentales
$(document).ready(function() {
  // Click en las tarjetas de competencias fundamentales
  $(".fundamental-competency-card").click(function(e) {
    // Si el click fue en el checkbox, dejar que se maneje normalmente
    if ($(e.target).is('input[type="checkbox"]')) {
      return;
    }
    
    // Toggle del checkbox
    const checkbox = $(this).find('input[type="checkbox"]');
    checkbox.prop('checked', !checkbox.prop('checked')).trigger('change');
  });
  
  // Cambio en checkboxes de competencias fundamentales
  $(".fundamental-competency-card input[type='checkbox']").change(function() {
    const card = $(this).closest('.fundamental-competency-card');
    const competenciaId = card.data('id');
    const competenciaText = card.find('label').text().trim();
    
    if ($(this).is(':checked')) {
      card.addClass('selected');
      
      // Agregar a seleccionadas si no existe
      if (!competenciasFundamentalesSeleccionadas.find(c => c.id === competenciaId)) {
        competenciasFundamentalesSeleccionadas.push({
          id: competenciaId,
          text: competenciaText
        });
      }
    } else {
      card.removeClass('selected');
      
      // Remover de seleccionadas
      competenciasFundamentalesSeleccionadas = competenciasFundamentalesSeleccionadas.filter(
        c => c.id !== competenciaId
      );
    }
    
    actualizarCompetenciasFundamentales();
  });
});

// Actualizar campo oculto de competencias fundamentales
function actualizarCompetenciasFundamentales() {
  $("#competenciasFundamentalesSeleccionadas").val(
    JSON.stringify(competenciasFundamentalesSeleccionadas)
  );
  
  // Marcar sección como completa si hay al menos una seleccionada
  if (competenciasFundamentalesSeleccionadas.length > 0) {
    marcarSeccionCompleta("competencias-fundamentales-section");
  } else {
    desmarcarSeccionCompleta("competencias-fundamentales-section");
  }
}

// Modificar la validación del paso 2 para incluir competencias fundamentales
function validateStep2() {
  const area = areaSeleccionada;
  const competenciasFundamentales = competenciasFundamentalesSeleccionadas.length;
  const competencias = competenciasSeleccionadas.length;
  const totalContenidos = Object.values(contenidosSeleccionados).reduce((total, arr) => total + arr.length, 0);
  const indicadores = indicadoresSeleccionados.length;
  
  return area && competenciasFundamentales > 0 && competencias > 0 && totalContenidos > 0 && indicadores > 0;
}
// Manejar cambio de tipo en el modal de materiales
$("#materialTipo").change(function() {
  const tipo = $(this).val();
  const urlSection = $("#materialUrlSection");
  const nivelSection = $("#materialNivelSection");
  const cantidadSection = $("#materialCantidadSection");
  
  // Mostrar/ocultar campos según el tipo
  if (["videojuego", "simulador", "aplicacion", "plataforma"].includes(tipo)) {
    urlSection.show();
    nivelSection.show();
    cantidadSection.hide();
    $("#materialUrl").prop("required", true);
  } else if (tipo === "fisico") {
    urlSection.hide();
    nivelSection.hide();
    cantidadSection.show();
    $("#materialUrl").prop("required", false);
  } else {
    urlSection.hide();
    nivelSection.hide();
    cantidadSection.hide();
    $("#materialUrl").prop("required", false);
  }
});

// Guardar material mejorado
$("#guardarMaterial").click(function(e) {
  e.stopPropagation();
  
  const tipo = $("#materialTipo").val();
  const nombre = $("#materialNombre").val().trim();
  const url = $("#materialUrl").val().trim();
  const descripcion = $("#materialDescripcion").val().trim();
  const nivel = $("#materialNivel").val();
  const tiempo = $("#materialTiempo").val();
  const cantidad = $("#materialCantidad").val();
  const fecha = $("#materialFecha").val();
  const hora = $("#materialHora").val();
  const estado = $("#materialEstado").val();
  
  if (!tipo || !nombre) {
    alert("Complete los campos requeridos");
    return;
  }
  
  // Validar URL para recursos digitales
  if (["videojuego", "simulador", "aplicacion", "plataforma"].includes(tipo) && !url) {
    alert("La URL es requerida para este type de recurso");
    return;
  }
  
  const recurso = {
    id: Date.now(),
    tipo: "material",
    subtipo: tipo,
    nombre: nombre,
    url: url || null,
    descripcion: descripcion,
    nivel: nivel,
    tiempo: tiempo,
    cantidad: cantidad || 1,
    fecha: fecha,
    hora: hora,
    estado: estado
  };
  
  agregarRecursoALista(recurso);
  
  // Limpiar formulario
  $("#materialForm")[0].reset();
  $("#materialUrlSection, #materialNivelSection, #materialCantidadSection").hide();
  
  $("#materialModal").modal('hide');
});

// Función para agregar recurso a la lista visual
function agregarRecursoALista(recurso) {
  const container = $("#recursosAgregados");
  
  // Remover estado vacío si existe
  container.find(".empty-resources-state").remove();
  
  // Determinar ícono según tipo
  let icono = 'fa-cube';
  let colorClass = 'text-warning';
  
  switch(recurso.subtipo) {
    case 'videojuego':
      icono = 'fa-gamepad';
      colorClass = 'text-success';
      break;
    case 'simulador':
      icono = 'fa-desktop';
      colorClass = 'text-info';
      break;
    case 'aplicacion':
      icono = 'fa-mobile-alt';
      colorClass = 'text-primary';
      break;
    case 'plataforma':
      icono = 'fa-graduation-cap';
      colorClass = 'text-danger';
      break;
  }
  
  // Crear elemento visual
  const recursoHTML = `
    <div class="custom-resource-item material-resource" data-resource-id="${recurso.id}">
      <div>
        <i class="fas ${icono} ${colorClass}"></i>
        <span><strong>${recurso.nombre}</strong></span>
        ${recurso.tiempo ? `<small class="text-muted ms-2">(${recurso.tiempo} min)</small>` : ''}
        ${recurso.url ? `<a href="${recurso.url}" class="resource-link ms-2" target="_blank" title="Abrir recurso">
                          <i class="fas fa-external-link-alt"></i>
                        </a>` : ''}
        ${recurso.nivel ? `<span class="badge bg-secondary ms-2">${recurso.nivel}</span>` : ''}
      </div>
      <i class="fas fa-times delete-resource" data-resource-id="${recurso.id}"></i>
    </div>
  `;
  
  container.append(recursoHTML);
  
  // Actualizar contador
  const total = container.find('.custom-resource-item').length;
  $("#totalRecursos").text(total);
  
  // Actualizar campo oculto
  actualizarRecursosGuardados();
}

function cargarCompetencias(area) {
  // Verificar si hay competencias fundamentales seleccionadas
  const fundamentalesSeleccionadas = Array.from(
    document.querySelectorAll(".fundamental-competency-card input[type='checkbox']")
  ).some(cb => cb.checked);

  const grid = $("#competenciasGridColumn");
  grid.empty();
  $("#competencias-count").text("0");

  if (!fundamentalesSeleccionadas) {
    grid.html(`
      <div class="empty-state">
        <i class="fas fa-graduation-cap"></i>
        <p>Seleccione al menos una competencia fundamental para ver las específicas</p>
      </div>
    `);
    return;
  }

  const competencias = competenciasPorArea[area] || [];

  if (competencias.length === 0) {
    grid.html(`
      <div class="empty-state">
        <i class="fas fa-graduation-cap"></i>
        <p>No hay competencias predefinidas para esta área</p>
      </div>
    `);
    return;
  }

  competencias.forEach((competencia, index) => {
    const competenciaId = `${area}_${index}`;
    const item = $(`
      <div class="grid-item" data-id="${competenciaId}" data-text="${competencia}">
        ${competencia}
        <i class="fas fa-check-circle check-icon"></i>
      </div>
    `);
    grid.append(item);

    item.on("click", function () {
  toggleCompetenciaGrid($(this)); // esta es tu lógica original
  updateContenidos(); // <-- importante: recarga los contenidos
});
  });

  

  $(".grid-item").click(function () {
    toggleCompetenciaGrid($(this));
  });

  generarIndicadoresAutomaticosGrid();
  actualizarContadores();
}


// Toggle para competencias en grid
function toggleCompetenciaGrid($item) {
  const competenciaId = $item.data("id");
  const competenciaText = $item.data("text");
  
  $item.toggleClass("selected");
  
  if ($item.hasClass("selected")) {
    if (!competenciasSeleccionadas.find(c => c.id === competenciaId)) {
      competenciasSeleccionadas.push({
        id: competenciaId,
        text: competenciaText,
        custom: $item.hasClass("custom")
      });
    }
  } else {
    competenciasSeleccionadas = competenciasSeleccionadas.filter(c => c.id !== competenciaId);
  }
  
  actualizarCompetenciasSeleccionadas();
  generarIndicadoresAutomaticosGrid();
  actualizarContadores();
}

// Función para agregar contenidos en la vista compacta
function agregarContenidoCompact(tipo) {
  const input = $(`#input${tipo.charAt(0).toUpperCase() + tipo.slice(1)}Compact`);
  const contenido = input.val().trim();
  
  if (contenido) {
    const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
    
    // Agregar al array
    if (!contenidosSeleccionados[tipoPlural]) {
      contenidosSeleccionados[tipoPlural] = [];
    }
    contenidosSeleccionados[tipoPlural].push(contenido);
    
    // Crear tag visual compacto
    const tag = $(`
      <div class="content-tag-compact" data-tipo="${tipo}" data-contenido="${contenido}">
        ${contenido}
        <span class="remove-tag" onclick="eliminarContenidoCompact('${tipo}', '${contenido}')">&times;</span>
      </div>
    `);
    
    $(`#${tipo}esCompact`).append(tag);
    input.val("");
    
    actualizarContenidosSeleccionados();
    actualizarContadores();
  }
}

// Eliminar contenido compacto
function eliminarContenidoCompact(tipo, contenido) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  
  // Remover del array
  contenidosSeleccionados[tipoPlural] = contenidosSeleccionados[tipoPlural].filter(c => c !== contenido);
  
  // Remover del DOM
  $(`.content-tag-compact[data-tipo="${tipo}"][data-contenido="${contenido}"]`).remove();
  
  actualizarContenidosSeleccionados();
  actualizarContadores();
}

// Generar indicadores automáticos para el grid
function generarIndicadoresAutomaticosGrid() {
  const indicadoresContainer = $("#indicadoresGridColumn");
  
  if (competenciasSeleccionadas.length === 0) {
    indicadoresContainer.html(`
      <div class="empty-state">
        <i class="fas fa-bullseye"></i>
        <p>Seleccione competencias para generar indicadores</p>
      </div>
    `);
    return;
  }
  
  // Limpiar indicadores existentes (mantener solo los personalizados)
  indicadoresContainer.find('.grid-item:not(.custom)').remove();
  indicadoresContainer.find('.empty-state').remove();
  
  // Generar indicadores
  const indicadoresGenerados = [
    "Demuestra comprensión de los conceptos fundamentales",
    "Aplica conocimientos en situaciones prácticas",
    "Analiza y resuelve problemas de forma sistemática",
    "Comunica ideas y resultados de manera clara",
    "Trabaja de forma autónoma y responsable",
    "Colabora efectivamente con sus compañeros"
  ];
  
  indicadoresGenerados.forEach((indicador, index) => {
    const indicadorId = `auto_${index}`;
    const item = $(`
      <div class="grid-item indicator-auto" data-id="${indicadorId}" data-text="${indicador}">
        ${indicador}
        <i class="fas fa-check-circle check-icon"></i>
      </div>
    `);
    
    indicadoresContainer.append(item);
  });
  
  // Event listeners
  $("#indicadoresGridColumn .grid-item").off('click').on('click', function() {
    toggleIndicadorGrid($(this));
  });
}

// Toggle para indicadores
function toggleIndicadorGrid($item) {
  const indicadorId = $item.data("id");
  const indicadorText = $item.data("text");
  
  $item.toggleClass("selected");
  
  if ($item.hasClass("selected")) {
    if (!indicadoresSeleccionados.find(i => i.id === indicadorId)) {
      indicadoresSeleccionados.push({
        id: indicadorId,
        text: indicadorText,
        custom: $item.hasClass("custom")
      });
    }
  } else {
    indicadoresSeleccionados = indicadoresSeleccionados.filter(i => i.id !== indicadorId);
  }
  
  actualizarIndicadoresSeleccionados();
  actualizarContadores();
}

// Actualizar contadores
function actualizarContadores() {
  // Competencias
  const competenciasCount = $("#competenciasGridColumn .grid-item.selected").length;
  $("#competencias-count").text(competenciasCount);
  
  // Contenidos
  const totalContenidos = Object.values(contenidosSeleccionados).reduce((total, arr) => total + arr.length, 0);
  $("#contenidos-count").text(totalContenidos);
  
  // Indicadores
  const indicadoresCount = $("#indicadoresGridColumn .grid-item.selected").length;
  $("#indicadores-count").text(indicadoresCount);
}

// Event listeners para los nuevos inputs
$(document).ready(function() {
  // Agregar competencia personalizada
  $("#btnAgregarCompetenciaGrid").click(function() {
    const competencia = $("#nuevaCompetenciaGrid").val().trim();
    if (competencia) {
      const competenciaId = `custom_${Date.now()}`;
      const item = $(`
        <div class="grid-item custom selected" data-id="${competenciaId}" data-text="${competencia}">
          ${competencia}
          <i class="fas fa-check-circle check-icon"></i>
        </div>
      `);
      
      $("#competenciasGridColumn .empty-state").remove();
      $("#competenciasGridColumn").append(item);
      
      item.click(function() {
        toggleCompetenciaGrid($(this));
      });
      
      // Agregar a seleccionadas
      competenciasSeleccionadas.push({
        id: competenciaId,
        text: competencia,
        custom: true
      });
      
      $("#nuevaCompetenciaGrid").val("");
      actualizarCompetenciasSeleccionadas();
      generarIndicadoresAutomaticosGrid();
      actualizarContadores();
    }
  });
  
  // Agregar indicador personalizado
  $("#btnAgregarIndicadorGrid").click(function() {
    const indicador = $("#nuevoIndicadorGrid").val().trim();
    if (indicador) {
      const indicadorId = `custom_${Date.now()}`;
      const item = $(`
        <div class="grid-item custom selected" data-id="${indicadorId}" data-text="${indicador}">
          ${indicador}
          <i class="fas fa-check-circle check-icon"></i>
        </div>
      `);
      
      $("#indicadoresGridColumn .empty-state").remove();
      $("#indicadoresGridColumn").append(item);
      
      item.click(function() {
        toggleIndicadorGrid($(this));
      });
      
      // Agregar a seleccionados
      indicadoresSeleccionados.push({
        id: indicadorId,
        text: indicador,
        custom: true
      });
      
      $("#nuevoIndicadorGrid").val("");
      actualizarIndicadoresSeleccionados();
      actualizarContadores();
    }
  });
  
  // Enter key para inputs
  $("#nuevaCompetenciaGrid, #nuevoIndicadorGrid").keypress(function(e) {
    if (e.which === 13) {
      $(this).next('button').click();
    }
  });
  
  $("[id$='Compact']").keypress(function(e) {
    if (e.which === 13) {
      $(this).next('button').click();
    }
  });
});

document.addEventListener("DOMContentLoaded", () => {
  const fundamentalCheckboxes = document.querySelectorAll(".fundamental-competency-card input[type='checkbox']");
  const competenciasGridColumn = document.getElementById("competenciasGridColumn");

  function actualizarVisibilidadCompetencias() {
    const algunaSeleccionada = Array.from(fundamentalCheckboxes).some(cb => cb.checked);
    
    // Si no hay competencia fundamental seleccionada, muestra solo el mensaje vacío
    if (!algunaSeleccionada) {
      competenciasGridColumn.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-graduation-cap"></i>
          <p>Seleccione una competencia fundamental para ver las competencias específicas</p>
        </div>
      `;
    } else {
      // Aquí puedes cargar o permitir la carga normal de competencias según el área
      // o dejar el sistema como está y que se llene dinámicamente al seleccionar el área.
      // No lo vaciamos, solo dejamos que el sistema trabaje normal después de eso
    }
  }

  fundamentalCheckboxes.forEach(cb => {
    cb.addEventListener("change", actualizarVisibilidadCompetencias);
  });



  // Inicializar en caso de que ya haya algo marcado
  actualizarVisibilidadCompetencias();

  document.querySelectorAll(".fundamental-competency-card input[type='checkbox']").forEach(cb => {
  cb.addEventListener("change", () => {
    const algunaSeleccionada = Array.from(
      document.querySelectorAll(".fundamental-competency-card input[type='checkbox']")
    ).some(input => input.checked);

    if (algunaSeleccionada) {
      const area = document.getElementById("areaSeleccionada").value;
      cargarCompetencias(area); // solo ahora se cargan
    } else {
      const grid = document.getElementById("competenciasGridColumn");
      grid.innerHTML = `
        <div class="empty-state">
          <i class="fas fa-graduation-cap"></i>
          <p>Seleccione al menos una competencia fundamental para ver las específicas</p>
        </div>
      `;
    }
  });
});

});

// Estructura de datos para contenidos por competencia
// ESTRUCTURA COMPLETA DE CONTENIDOS POR COMPETENCIA
const contenidosPorCompetencia = {
 // MATEMÁTICAS
 "matematicas_0": { // Resuelve problemas utilizando operaciones matemáticas básicas
   conceptuales: [
     "Números naturales hasta el millón",
     "Operaciones básicas: suma, resta, multiplicación y división",
     "Propiedades de las operaciones",
     "Orden de operaciones",
     "Números decimales y fracciones"
   ],
   procedimentales: [
     "Resolver problemas de la vida cotidiana",
     "Aplicar algoritmos de cálculo",
     "Verificar resultados mediante pruebas",
     "Estimar resultados antes de calcular",
     "Utilizar la calculadora apropiadamente"
   ],
   actitudinales: [
     "Valoración de la precisión matemática",
     "Perseverancia en la resolución",
     "Confianza en sus capacidades",
     "Actitud crítica ante los resultados",
     "Honestidad al presentar resultados"
   ]
 },
 "matematicas_1": { // Comprende y aplica conceptos geométricos
   conceptuales: [
     "Figuras geométricas planas",
     "Cuerpos geométricos",
     "Perímetro y área",
     "Ángulos y sus medidas",
     "Sistema de coordenadas"
   ],
   procedimentales: [
     "Construir figuras con regla y compás",
     "Medir y calcular áreas",
     "Identificar figuras en el entorno",
     "Trazar figuras simétricas",
     "Resolver problemas geométricos"
   ],
   actitudinales: [
     "Apreciación de la geometría en el arte",
     "Curiosidad por las formas naturales",
     "Orden y precisión en construcciones",
     "Creatividad en diseños geométricos",
     "Valoración del espacio"
   ]
 },

 // LENGUA ESPAÑOLA
 "lenguaje_0": { // Comprende textos orales y escritos
   conceptuales: [
     "Tipos de textos: narrativos, descriptivos, instructivos",
     "Estructura textual: inicio, desarrollo, cierre",
     "Elementos de la comunicación",
     "Vocabulario contextual",
     "Ideas principales y secundarias"
   ],
   procedimentales: [
     "Identificar información explícita",
     "Inferir información implícita",
     "Resumir textos leídos",
     "Responder preguntas de comprensión",
     "Relacionar texto con experiencias"
   ],
   actitudinales: [
     "Disfrute de la lectura",
     "Respeto por diferentes opiniones",
     "Valoración de la diversidad textual",
     "Interés por comprender",
     "Apertura a nuevos conocimientos"
   ]
 },
 "lenguaje_1": { // Produce textos escritos
   conceptuales: [
     "Estructura de párrafos",
     "Conectores textuales",
     "Signos de puntuación",
     "Ortografía básica",
     "Tipos de oraciones"
   ],
   procedimentales: [
     "Planificar la escritura",
     "Escribir borradores",
     "Revisar y corregir textos",
     "Publicar textos finales",
     "Usar diccionario"
   ],
   actitudinales: [
     "Creatividad en la escritura",
     "Responsabilidad con la calidad",
     "Perseverancia en la mejora",
     "Orgullo por sus producciones",
     "Respeto por las normas"
   ]
 },

 // CIENCIAS NATURALES
 "ciencias_naturales_0": { // Investiga fenómenos naturales
   conceptuales: [
     "El método científico",
     "Estados de la materia",
     "Cambios físicos y químicos",
     "Fuerzas y movimiento",
     "Energía y sus transformaciones"
   ],
   procedimentales: [
     "Observar sistemáticamente",
     "Formular hipótesis",
     "Realizar experimentos sencillos",
     "Registrar datos",
     "Elaborar conclusiones"
   ],
   actitudinales: [
     "Curiosidad científica",
     "Respeto por la evidencia",
     "Cuidado con los materiales",
     "Trabajo colaborativo",
     "Honestidad en los resultados"
   ]
 },

 // CIENCIAS SOCIALES
 "ciencias_sociales_0": { // Analiza procesos históricos
   conceptuales: [
     "Períodos de la historia dominicana",
     "Símbolos patrios",
     "Organización política del país",
     "Derechos y deberes ciudadanos",
     "Patrimonio cultural"
   ],
   procedimentales: [
     "Construir líneas de tiempo",
     "Interpretar fuentes históricas",
     "Elaborar mapas conceptuales",
     "Investigar en diversas fuentes",
     "Comparar épocas históricas"
   ],
   actitudinales: [
     "Valoración de la identidad nacional",
     "Respeto por la diversidad",
     "Compromiso ciudadano",
     "Orgullo por el patrimonio",
     "Sentido de pertenencia"
   ]
 }
};

// ESTRUCTURA COMPLETA DE INDICADORES POR CONTENIDO
const indicadoresPorContenido = {
 // MATEMÁTICAS - Conceptuales
 "Números naturales hasta el millón": [
   "Lee y escribe números hasta el millón",
   "Compara y ordena números naturales",
   "Identifica el valor posicional",
   "Descompone números en sus órdenes"
 ],
 "Operaciones básicas: suma, resta, multiplicación y división": [
   "Realiza sumas con reagrupación",
   "Efectúa restas con desagrupación",
   "Multiplica por dos y tres cifras",
   "Divide entre una y dos cifras"
 ],
 "Figuras geométricas planas": [
   "Identifica triángulos, cuadrados, rectángulos",
   "Clasifica figuras por sus propiedades",
   "Reconoce figuras en el entorno",
   "Diferencia polígonos regulares e irregulares"
 ],
 
 // MATEMÁTICAS - Procedimentales
 "Resolver problemas de la vida cotidiana": [
   "Identifica datos relevantes del problema",
   "Selecciona la operación adecuada",
   "Ejecuta el plan de solución",
   "Verifica si la respuesta es razonable"
 ],
 "Construir figuras con regla y compás": [
   "Maneja correctamente los instrumentos",
   "Sigue instrucciones de construcción",
   "Verifica las medidas realizadas",
   "Presenta construcciones limpias"
 ],
 
 // LENGUA ESPAÑOLA - Conceptuales
 "Tipos de textos: narrativos, descriptivos, instructivos": [
   "Diferencia un cuento de una noticia",
   "Identifica características de cada tipo",
   "Reconoce la intención del autor",
   "Clasifica textos según su tipo"
 ],
 "Estructura textual: inicio, desarrollo, cierre": [
   "Localiza las tres partes en un texto",
   "Identifica la introducción",
   "Reconoce el desarrollo de ideas",
   "Encuentra la conclusión"
 ],
 
 // LENGUA ESPAÑOLA - Procedimentales
 "Identificar información explícita": [
   "Localiza datos específicos",
   "Responde preguntas literales",
   "Encuentra información directa",
   "Identifica personajes y lugares"
 ],
 "Planificar la escritura": [
   "Genera lluvia de ideas",
   "Organiza ideas en esquema",
   "Define propósito del texto",
   "Selecciona tipo de texto"
 ],
 
 // CIENCIAS NATURALES - Conceptuales
 "El método científico": [
   "Identifica las etapas del método",
   "Reconoce la importancia de cada paso",
   "Diferencia observación de inferencia",
   "Comprende qué es una hipótesis"
 ],
 "Estados de la materia": [
   "Identifica sólidos, líquidos y gases",
   "Reconoce características de cada estado",
   "Da ejemplos de cada estado",
   "Comprende los cambios de estado"
 ],
 
 // CIENCIAS SOCIALES - Conceptuales
 "Períodos de la historia dominicana": [
   "Identifica período precolombino",
   "Reconoce la época colonial",
   "Ubica la independencia nacional",
   "Conoce la era republicana"
 ],
 
 // ACTITUDINALES
 "Valoración de la precisión matemática": [
   "Revisa sus cálculos antes de entregar",
   "Muestra cuidado en las operaciones",
   "Aprecia respuestas exactas",
   "Corrige errores voluntariamente"
 ],
 "Disfrute de la lectura": [
   "Lee voluntariamente en tiempo libre",
   "Comparte lecturas con compañeros",
   "Recomienda libros a otros",
   "Visita la biblioteca regularmente"
 ],
 "Curiosidad científica": [
   "Formula preguntas espontáneas",
   "Propone experimentos",
   "Busca explicaciones",
   "Muestra asombro ante fenómenos"
 ],
 "Valoración de la identidad nacional": [
   "Respeta los símbolos patrios",
   "Participa en actos cívicos",
   "Muestra orgullo por su cultura",
   "Valora las tradiciones"
 ]
};

// Modificar la función toggleCompetenciaGrid existente
function toggleCompetenciaGrid($item) {
  const competenciaId = $item.data("id");
  const competenciaText = $item.data("text");
  
  $item.toggleClass("selected");
  
  if ($item.hasClass("selected")) {
    if (!competenciasSeleccionadas.find(c => c.id === competenciaId)) {
      competenciasSeleccionadas.push({
        id: competenciaId,
        text: competenciaText,
        custom: $item.hasClass("custom")
      });
    }
  } else {
    competenciasSeleccionadas = competenciasSeleccionadas.filter(c => c.id !== competenciaId);
  }
  
  actualizarCompetenciasSeleccionadas();
  actualizarContenidosPorCompetencias(); // Nueva función
  actualizarContadores();
}

// Nueva función para actualizar contenidos
function actualizarContenidosPorCompetencias() {
  // Limpiar contenidos actuales
  $("#conceptualesCompact, #procedimentalesCompact, #actitudinalesCompact").empty();
  contenidosSeleccionados = {
    conceptuales: [],
    procedimentales: [],
    actitudinales: []
  };
  
  // Si no hay competencias, mostrar mensaje
  if (competenciasSeleccionadas.length === 0) {
    $("#indicadoresGridColumn").html(`
      <div class="empty-state">
        <i class="fas fa-bullseye"></i>
        <p>Seleccione competencias y contenidos</p>
      </div>
    `);
    return;
  }
  
  // Cargar contenidos para cada competencia seleccionada
  competenciasSeleccionadas.forEach(comp => {
    const contenidos = contenidosPorCompetencia[comp.id];
    if (contenidos) {
      contenidos.conceptuales?.forEach(c => mostrarContenido('conceptual', c));
      contenidos.procedimentales?.forEach(c => mostrarContenido('procedimental', c));
      contenidos.actitudinales?.forEach(c => mostrarContenido('actitudinal', c));
    }
  });
}

// Función para mostrar contenido con capacidad de selección
function mostrarContenido(tipo, contenido) {
  const tipoPlural = tipo + (tipo.endsWith('l') ? 'es' : 's');
  
  if (!contenidosSeleccionados[tipoPlural].includes(contenido)) {
    contenidosSeleccionados[tipoPlural].push(contenido);
    
    const tag = $(`
      <div class="content-tag-compact selectable-content" 
           data-tipo="${tipo}" 
           data-contenido="${contenido}"
           style="cursor: pointer;">
        ${contenido}
        <span class="remove-tag" onclick="eliminarContenidoCompact('${tipo}', '${contenido}')">&times;</span>
      </div>
    `);
    
    $(`#${tipo}esCompact`).append(tag);
    
    // Click para seleccionar contenido
    tag.click(function(e) {
      if (!$(e.target).hasClass('remove-tag')) {
        $(this).toggleClass('selected-content');
        actualizarIndicadoresPorContenidos();
      }
    });
  }
}

// Nueva función para actualizar indicadores
function actualizarIndicadoresPorContenidos() {
  const indicadoresContainer = $("#indicadoresGridColumn");
  indicadoresContainer.empty();
  
  // Obtener contenidos seleccionados
  const contenidosSeleccionadosActuales = $('.content-tag-compact.selected-content');
  
  if (contenidosSeleccionadosActuales.length === 0) {
    indicadoresContainer.html(`
      <div class="empty-state">
        <i class="fas fa-bullseye"></i>
        <p>Seleccione contenidos para ver indicadores</p>
      </div>
    `);
    return;
  }
  
  // Mostrar indicadores para cada contenido seleccionado
  contenidosSeleccionadosActuales.each(function() {
    const contenido = $(this).data('contenido');
    const indicadores = indicadoresPorContenido[contenido];
    
    if (indicadores) {
      indicadores.forEach(indicador => {
        const item = $(`
          <div class="grid-item" data-text="${indicador}">
            ${indicador}
            <i class="fas fa-check-circle check-icon"></i>
          </div>
        `);
        
        indicadoresContainer.append(item);
        
        item.click(function() {
          toggleIndicadorGrid($(this));
        });
      });
    }
  });
  
  actualizarContadores();
}

// Agregar estilos CSS
const estilosCascada = `
<style>
.selectable-content {
  transition: all 0.3s ease;
  border: 1px solid transparent;
}

.selectable-content:hover {
  border-color: #007bff;
  background-color: rgba(0, 123, 255, 0.1);
}

.selected-content {
  background-color: #007bff !important;
  color: white !important;
  border-color: #0056b3 !important;
}

.selected-content .remove-tag {
  color: white;
}
</style>
`;

// Insertar estilos
$('head').append(estilosCascada);

// Control de duración con flechas
$(".duration-btn-up").click(function() {
  const current = parseInt($("#actDuration").val()) || 0;
  const newValue = Math.min(current + 5, 240);
  $("#actDuration").val(newValue);
  updateDurationDisplay();
});

$(".duration-btn-down").click(function() {
  const current = parseInt($("#actDuration").val()) || 0;
  const newValue = Math.max(current - 5, 0);
  $("#actDuration").val(newValue);
  updateDurationDisplay();
});

function updateDurationDisplay() {
  const duration = $("#actDuration").val();
  if (duration == 0) {
    $("#actDuration").attr("placeholder", "0 min");
  } else {
    $("#actDuration").attr("placeholder", duration + " min");
  }
}
// Función auxiliar para cargar recursos en edición
function agregarRecursoAListaEdit(recurso) {
  const container = $("#recursosAgregados");
  container.find(".empty-resources-state").remove();
  
  let icono = 'fa-cube';
  let colorClass = 'text-warning';
  
  switch(recurso.tipo) {
    case 'youtube':
      icono = 'fa-youtube';
      colorClass = 'text-danger';
      break;
    case 'enlace':
      icono = 'fa-link';
      colorClass = 'text-primary';
      break;
    case 'archivo':
      icono = 'fa-file-alt';
      colorClass = 'text-success';
      break;
  }
  
  const recursoHTML = `
    <div class="custom-resource-item" data-resource-id="${recurso.id}">
      <div>
        <i class="fas ${icono} ${colorClass}"></i>
        <span><strong>${recurso.nombre}</strong></span>
        ${recurso.url ? `<a href="${recurso.url}" class="resource-link ms-2" target="_blank">
                          <i class="fas fa-external-link-alt"></i>
                        </a>` : ''}
      </div>
      <i class="fas fa-times delete-resource" data-resource-id="${recurso.id}"></i>
    </div>
  `;
  
  container.append(recursoHTML);
  $("#totalRecursos").text(container.find('.custom-resource-item').length);
}
  // FUNCIONES DE RECURSOS DIGITALES - VERSIÓN SIMPLE
$(document).ready(function() {
  
  // Variable para recursos de la actividad actual
  window.recursosActividadActual = [];
  
  // YouTube
  $(document).on('click', '#guardarYoutube', function(e) {
    e.preventDefault();
    console.log("Botón YouTube clickeado");
    
    const nombre = $("#youtubeNombre").val().trim();
    const url = $("#youtubeUrl").val().trim();
    
    if (!nombre || !url) {
      alert("Complete Nombre y URL");
      return;
    }
    
    const recurso = {
      id: Date.now(),
      tipo: "youtube",
      nombre: nombre,
      url: url,
      icono: "fa-youtube",
      color: "text-danger"
    };
    
    window.recursosActividadActual.push(recurso);
    actualizarListaRecursos();
    
    // Limpiar y cerrar
    $("#youtubeForm")[0].reset();
    $("#youtubeModal").modal('hide');
    
    console.log("Recurso YouTube agregado:", recurso);
  });
  
  // Enlaces
  $(document).on('click', '#guardarEnlace', function(e) {
    e.preventDefault();
    console.log("Botón Enlaces clickeado");
    
    const nombre = $("#enlaceNombre").val().trim();
    const url = $("#enlaceUrl").val().trim();
    
    if (!nombre || !url) {
      alert("Complete Nombre y URL");
      return;
    }
    
    const recurso = {
      id: Date.now(),
      tipo: "enlace",
      nombre: nombre,
      url: url,
      icono: "fa-link",
      color: "text-primary"
    };
    
    window.recursosActividadActual.push(recurso);
    actualizarListaRecursos();
    
    $("#enlaceForm")[0].reset();
    $("#enlaceModal").modal('hide');
    
    console.log("Recurso Enlace agregado:", recurso);
  });
  
  // Archivos
  $(document).on('click', '#guardarArchivo', function(e) {
    e.preventDefault();
    console.log("Botón Archivo clickeado");
    
    const nombre = $("#archivoNombre").val().trim();
    const url = $("#archivoUrl").val().trim();
    
    if (!nombre || !url) {
      alert("Complete Nombre y URL");
      return;
    }
    
    const recurso = {
      id: Date.now(),
      tipo: "archivo",
      nombre: nombre,
      url: url,
      icono: "fa-file-alt",
      color: "text-success"
    };
    
    window.recursosActividadActual.push(recurso);
    actualizarListaRecursos();
    
    $("#archivoForm")[0].reset();
    $("#archivoModal").modal('hide');
    
    console.log("Recurso Archivo agregado:", recurso);
  });
  
  // Material
  $(document).on('click', '#guardarMaterial', function(e) {
    e.preventDefault();
    console.log("Botón Material clickeado");
    
    const nombre = $("#materialNombre").val().trim();
    const tipo = $("#materialTipo").val();
    
    if (!nombre || !tipo) {
      alert("Complete Nombre y Tipo");
      return;
    }
    
    const recurso = {
      id: Date.now(),
      tipo: "material",
      nombre: nombre,
      subtipo: tipo,
      icono: "fa-cube",
      color: "text-warning"
    };
    
    window.recursosActividadActual.push(recurso);
    actualizarListaRecursos();
    
    $("#materialForm")[0].reset();
    $("#materialModal").modal('hide');
    
    console.log("Recurso Material agregado:", recurso);
  });
  
  // Función para actualizar la lista visual
  function actualizarListaRecursos() {
    const container = $("#recursosAgregados");
    container.empty();
    
    if (window.recursosActividadActual.length === 0) {
      container.html(`
        <div class="empty-resources-state text-center p-4">
          <i class="fas fa-folder-open fa-3x text-muted mb-3 opacity-50"></i>
          <p class="text-muted">No hay recursos digitales agregados.</p>
        </div>
      `);
      $("#totalRecursos").text('0');
      return;
    }
    
    window.recursosActividadActual.forEach(recurso => {
      const html = `
        <div class="custom-resource-item" data-resource-id="${recurso.id}">
          <div>
            <i class="fas ${recurso.icono} ${recurso.color}"></i>
            <span><strong>${recurso.nombre}</strong></span>
            ${recurso.url ? `<a href="${recurso.url}" target="_blank" class="ms-2"><i class="fas fa-external-link-alt"></i></a>` : ''}
          </div>
          <i class="fas fa-times delete-resource" data-resource-id="${recurso.id}" style="cursor: pointer; color: #dc3545;"></i>
        </div>
      `;
      container.append(html);
    });
    
    $("#totalRecursos").text(window.recursosActividadActual.length);
  }
  
  // Eliminar recurso
  $(document).on('click', '.delete-resource', function() {
    const id = $(this).data('resource-id');   
    window.recursosActividadActual = window.recursosActividadActual.filter(r => r.id != id);
    actualizarListaRecursos();
  });
  
  // Inicializar
  window.recursosActividadActual = [];
  actualizarListaRecursos();
  
  console.log("Sistema de recursos inicializado");
});

// Inicializar display
updateDurationDisplay();
  </script>
</body>
</html>
